<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3与Vue2对比 | Vivien&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/vivien-blog/logo.jpg">
    <script src="/vivien-blog/watermark.js"></script>
    <meta name="description" content="Vivien个人博客">
    
    <link rel="preload" href="/vivien-blog/assets/css/0.styles.4edee94f.css" as="style"><link rel="preload" href="/vivien-blog/assets/js/app.06802b84.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/7.ec60f3e8.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/2.6744b811.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/1.4a3363c7.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/22.de88dfed.js" as="script"><link rel="prefetch" href="/vivien-blog/assets/js/10.4c4f923d.js"><link rel="prefetch" href="/vivien-blog/assets/js/100.23f6ee21.js"><link rel="prefetch" href="/vivien-blog/assets/js/101.27280ff0.js"><link rel="prefetch" href="/vivien-blog/assets/js/102.036dcfc2.js"><link rel="prefetch" href="/vivien-blog/assets/js/103.dd57924a.js"><link rel="prefetch" href="/vivien-blog/assets/js/104.c64926ce.js"><link rel="prefetch" href="/vivien-blog/assets/js/105.ae22082c.js"><link rel="prefetch" href="/vivien-blog/assets/js/106.407a6b6f.js"><link rel="prefetch" href="/vivien-blog/assets/js/107.c8a4dfa2.js"><link rel="prefetch" href="/vivien-blog/assets/js/108.9c61cc83.js"><link rel="prefetch" href="/vivien-blog/assets/js/109.c1172022.js"><link rel="prefetch" href="/vivien-blog/assets/js/11.c96b7ce6.js"><link rel="prefetch" href="/vivien-blog/assets/js/110.a8a43b83.js"><link rel="prefetch" href="/vivien-blog/assets/js/111.4c5d72c5.js"><link rel="prefetch" href="/vivien-blog/assets/js/112.31c468c6.js"><link rel="prefetch" href="/vivien-blog/assets/js/113.7c8ad5fd.js"><link rel="prefetch" href="/vivien-blog/assets/js/114.2919ddce.js"><link rel="prefetch" href="/vivien-blog/assets/js/115.9492e6b7.js"><link rel="prefetch" href="/vivien-blog/assets/js/116.e44be688.js"><link rel="prefetch" href="/vivien-blog/assets/js/117.64b0ae65.js"><link rel="prefetch" href="/vivien-blog/assets/js/118.4dae8780.js"><link rel="prefetch" href="/vivien-blog/assets/js/119.e61066ef.js"><link rel="prefetch" href="/vivien-blog/assets/js/120.95523cfb.js"><link rel="prefetch" href="/vivien-blog/assets/js/121.7279e08a.js"><link rel="prefetch" href="/vivien-blog/assets/js/122.1946f5d1.js"><link rel="prefetch" href="/vivien-blog/assets/js/123.1d46e7f2.js"><link rel="prefetch" href="/vivien-blog/assets/js/124.0e99b17d.js"><link rel="prefetch" href="/vivien-blog/assets/js/125.e4ce0029.js"><link rel="prefetch" href="/vivien-blog/assets/js/126.9e0257d6.js"><link rel="prefetch" href="/vivien-blog/assets/js/127.258e05ea.js"><link rel="prefetch" href="/vivien-blog/assets/js/128.b51fe943.js"><link rel="prefetch" href="/vivien-blog/assets/js/129.487c56e8.js"><link rel="prefetch" href="/vivien-blog/assets/js/130.cd9ca58a.js"><link rel="prefetch" href="/vivien-blog/assets/js/131.bf7582dc.js"><link rel="prefetch" href="/vivien-blog/assets/js/132.e45a11da.js"><link rel="prefetch" href="/vivien-blog/assets/js/14.dac78458.js"><link rel="prefetch" href="/vivien-blog/assets/js/15.30ff7af8.js"><link rel="prefetch" href="/vivien-blog/assets/js/16.f5bca61b.js"><link rel="prefetch" href="/vivien-blog/assets/js/17.7fea8ba1.js"><link rel="prefetch" href="/vivien-blog/assets/js/18.8a66241c.js"><link rel="prefetch" href="/vivien-blog/assets/js/19.9f2773f4.js"><link rel="prefetch" href="/vivien-blog/assets/js/20.7b40b439.js"><link rel="prefetch" href="/vivien-blog/assets/js/21.53d462a3.js"><link rel="prefetch" href="/vivien-blog/assets/js/23.f2b02a6d.js"><link rel="prefetch" href="/vivien-blog/assets/js/24.f74a3560.js"><link rel="prefetch" href="/vivien-blog/assets/js/25.16232f0b.js"><link rel="prefetch" href="/vivien-blog/assets/js/26.bf9dc0fe.js"><link rel="prefetch" href="/vivien-blog/assets/js/27.806995a3.js"><link rel="prefetch" href="/vivien-blog/assets/js/28.42a6ae8d.js"><link rel="prefetch" href="/vivien-blog/assets/js/29.5763dada.js"><link rel="prefetch" href="/vivien-blog/assets/js/3.7a6d346e.js"><link rel="prefetch" href="/vivien-blog/assets/js/30.a0c45895.js"><link rel="prefetch" href="/vivien-blog/assets/js/31.a10b30c7.js"><link rel="prefetch" href="/vivien-blog/assets/js/32.4c227bf7.js"><link rel="prefetch" href="/vivien-blog/assets/js/33.9873b2e4.js"><link rel="prefetch" href="/vivien-blog/assets/js/34.661b84b0.js"><link rel="prefetch" href="/vivien-blog/assets/js/35.e6dccfdc.js"><link rel="prefetch" href="/vivien-blog/assets/js/36.98205037.js"><link rel="prefetch" href="/vivien-blog/assets/js/37.6a8d61d5.js"><link rel="prefetch" href="/vivien-blog/assets/js/38.dc9c4a51.js"><link rel="prefetch" href="/vivien-blog/assets/js/39.be23166d.js"><link rel="prefetch" href="/vivien-blog/assets/js/4.6d6477a3.js"><link rel="prefetch" href="/vivien-blog/assets/js/40.e5f670f0.js"><link rel="prefetch" href="/vivien-blog/assets/js/41.236d900a.js"><link rel="prefetch" href="/vivien-blog/assets/js/42.67482f69.js"><link rel="prefetch" href="/vivien-blog/assets/js/43.1de2024a.js"><link rel="prefetch" href="/vivien-blog/assets/js/44.7ddd9470.js"><link rel="prefetch" href="/vivien-blog/assets/js/45.31587bf5.js"><link rel="prefetch" href="/vivien-blog/assets/js/46.f1560a94.js"><link rel="prefetch" href="/vivien-blog/assets/js/47.d3d247b3.js"><link rel="prefetch" href="/vivien-blog/assets/js/48.927b0f38.js"><link rel="prefetch" href="/vivien-blog/assets/js/49.8e7e832e.js"><link rel="prefetch" href="/vivien-blog/assets/js/5.8f70aa2d.js"><link rel="prefetch" href="/vivien-blog/assets/js/50.e8d25d24.js"><link rel="prefetch" href="/vivien-blog/assets/js/51.44c4ad27.js"><link rel="prefetch" href="/vivien-blog/assets/js/52.fbef7aa0.js"><link rel="prefetch" href="/vivien-blog/assets/js/53.2b707def.js"><link rel="prefetch" href="/vivien-blog/assets/js/54.b5188815.js"><link rel="prefetch" href="/vivien-blog/assets/js/55.8b80c528.js"><link rel="prefetch" href="/vivien-blog/assets/js/56.ff6f8345.js"><link rel="prefetch" href="/vivien-blog/assets/js/57.ddbebf8b.js"><link rel="prefetch" href="/vivien-blog/assets/js/58.b4c57804.js"><link rel="prefetch" href="/vivien-blog/assets/js/59.a035b4e8.js"><link rel="prefetch" href="/vivien-blog/assets/js/6.892ce6e5.js"><link rel="prefetch" href="/vivien-blog/assets/js/60.b8bfb276.js"><link rel="prefetch" href="/vivien-blog/assets/js/61.843f60af.js"><link rel="prefetch" href="/vivien-blog/assets/js/62.51cffd1c.js"><link rel="prefetch" href="/vivien-blog/assets/js/63.91b00a61.js"><link rel="prefetch" href="/vivien-blog/assets/js/64.48a3a79a.js"><link rel="prefetch" href="/vivien-blog/assets/js/65.1f90e370.js"><link rel="prefetch" href="/vivien-blog/assets/js/66.8e9ea32a.js"><link rel="prefetch" href="/vivien-blog/assets/js/67.18095c46.js"><link rel="prefetch" href="/vivien-blog/assets/js/68.f74a0870.js"><link rel="prefetch" href="/vivien-blog/assets/js/69.4e844f29.js"><link rel="prefetch" href="/vivien-blog/assets/js/70.41013b20.js"><link rel="prefetch" href="/vivien-blog/assets/js/71.26e44e39.js"><link rel="prefetch" href="/vivien-blog/assets/js/72.be7cf2c3.js"><link rel="prefetch" href="/vivien-blog/assets/js/73.1808562e.js"><link rel="prefetch" href="/vivien-blog/assets/js/74.6db7cdee.js"><link rel="prefetch" href="/vivien-blog/assets/js/75.d9ad6528.js"><link rel="prefetch" href="/vivien-blog/assets/js/76.7bc9c5d1.js"><link rel="prefetch" href="/vivien-blog/assets/js/77.b953a6d1.js"><link rel="prefetch" href="/vivien-blog/assets/js/78.240ef1ab.js"><link rel="prefetch" href="/vivien-blog/assets/js/79.ff61e0ac.js"><link rel="prefetch" href="/vivien-blog/assets/js/8.b0ba342b.js"><link rel="prefetch" href="/vivien-blog/assets/js/80.dfa3f211.js"><link rel="prefetch" href="/vivien-blog/assets/js/81.285bac2c.js"><link rel="prefetch" href="/vivien-blog/assets/js/82.f50cbf20.js"><link rel="prefetch" href="/vivien-blog/assets/js/83.6440b662.js"><link rel="prefetch" href="/vivien-blog/assets/js/84.bfd378d6.js"><link rel="prefetch" href="/vivien-blog/assets/js/85.b9ac818d.js"><link rel="prefetch" href="/vivien-blog/assets/js/86.2ee8cc6a.js"><link rel="prefetch" href="/vivien-blog/assets/js/87.56fa5a36.js"><link rel="prefetch" href="/vivien-blog/assets/js/88.be00769d.js"><link rel="prefetch" href="/vivien-blog/assets/js/89.e1d81528.js"><link rel="prefetch" href="/vivien-blog/assets/js/9.524cff04.js"><link rel="prefetch" href="/vivien-blog/assets/js/90.e5cb233a.js"><link rel="prefetch" href="/vivien-blog/assets/js/91.15feaa5b.js"><link rel="prefetch" href="/vivien-blog/assets/js/92.44aad763.js"><link rel="prefetch" href="/vivien-blog/assets/js/93.45a553ea.js"><link rel="prefetch" href="/vivien-blog/assets/js/94.74a76eb1.js"><link rel="prefetch" href="/vivien-blog/assets/js/95.6314d68a.js"><link rel="prefetch" href="/vivien-blog/assets/js/96.0def9066.js"><link rel="prefetch" href="/vivien-blog/assets/js/97.1010a1a2.js"><link rel="prefetch" href="/vivien-blog/assets/js/98.5dd57b30.js"><link rel="prefetch" href="/vivien-blog/assets/js/99.b01b0c86.js"><link rel="prefetch" href="/vivien-blog/assets/js/vendors~docsearch.da1394aa.js">
    <link rel="stylesheet" href="/vivien-blog/assets/css/0.styles.4edee94f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-222e0b9d><div data-v-222e0b9d><div class="password-shadow password-wrapper-out" style="display:none;" data-v-15719524 data-v-222e0b9d data-v-222e0b9d><h3 class="title" data-v-15719524>Vivien's Notebook</h3> <p class="description" data-v-15719524>Vivien个人博客</p> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div class="hide" data-v-222e0b9d><header class="navbar" data-v-222e0b9d><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vivien-blog/" class="home-link router-link-active"><img src="/vivien-blog/logo.jpg" alt="Vivien's Notebook" class="logo"> <span class="site-name">Vivien's Notebook</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-222e0b9d></div> <aside class="sidebar" data-v-222e0b9d><div class="personal-info-wrapper" data-v-2710484f data-v-222e0b9d><img src="/vivien-blog/avator.jpg" alt="author-avatar" class="personal-img" data-v-2710484f> <!----> <div class="num" data-v-2710484f><div data-v-2710484f><h3 data-v-2710484f>92</h3> <h6 data-v-2710484f>文章</h6></div> <div data-v-2710484f><h3 data-v-2710484f>11</h3> <h6 data-v-2710484f>标签</h6></div></div> <ul class="social-links" data-v-2710484f><li class="social-item" data-v-2710484f><i class="iconfont reco-github" style="color:#e15b64;" data-v-2710484f></i></li></ul> <hr data-v-2710484f></div> <nav class="nav-links"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue3学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比.html" class="active sidebar-link">Vue3与Vue2对比</a></li><li><a href="/vivien-blog/Vue/Vue3学习笔记/创建Vue3项目.html" class="sidebar-link">创建Vue3项目</a></li><li><a href="/vivien-blog/Vue/Vue3学习笔记/CompositionAPI.html" class="sidebar-link">Composition API</a></li><li><a href="/vivien-blog/Vue/Vue3学习笔记/新的组件.html" class="sidebar-link">新的组件</a></li><li><a href="/vivien-blog/Vue/Vue3学习笔记/其它新的API.html" class="sidebar-link">其它新的API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/Vue/原理学习/Vue2响应式原理.html" class="sidebar-link">Vue2响应式原理</a></li><li><a href="/vivien-blog/Vue/原理学习/VueCLI.html" class="sidebar-link">VueCLI学习笔记</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-15719524 data-v-222e0b9d><h3 class="title" data-v-15719524>Vue3与Vue2对比</h3> <!----> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div data-v-222e0b9d><div data-v-222e0b9d><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Vue3与Vue2对比</h1> <div data-v-f31d237c><i class="iconfont reco-account" data-v-f31d237c><span data-v-f31d237c>vivien</span></i> <i class="iconfont reco-date" data-v-f31d237c><span data-v-f31d237c>2024/3/23</span></i> <i class="iconfont reco-eye" data-v-f31d237c><span id="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f31d237c><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-f31d237c><span class="tag-item" data-v-f31d237c>Vue</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="相关信息简介"><a href="#相关信息简介" class="header-anchor">#</a> 相关信息简介</h2> <p>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</p> <p>2 年多开发, 100+位贡献者, 2600+次提交, 600+次 PR、30+个RFC</p> <p>Vue3 支持 vue2 的大多数特性</p> <p>可以更好的支持 Typescript，提供了完整的类型定义</p> <p>使用了改进的 Vue CLI，可以更加灵活地配置项目，同时支持 Vue2.x 项目升级到Vue3</p> <p>Vue3 的自定义渲染 API 允许开发者在细粒度上控制组件渲染行为，包括自定义渲染器、组件事件和生命周期等，扩展能力强</p> <h1 id="一、vue3-对比-vue2"><a href="#一、vue3-对比-vue2" class="header-anchor">#</a> 一、Vue3 对比 Vue2</h1> <p>更小：Vue3移除一些不常用的 API，引入tree-shaking，可以仅打包需要的，使打包整体体积变小了。</p> <p>更快：主要体现在编译方面，比如diff算法优化、静态提升、事件监听缓存、SSR优化。</p> <p>更友好：vue3在兼顾Vue2的options API的同时还推出了composition API，大大增加了代码的逻辑组织和代码复用能力。</p> <p><img src="/vivien-blog/assets/img/bb04ceaf5f044d308100e2bf0447f8cctplv-k3u1fbpfcp-jj-mark3024000q75.66f8c4dc.png" alt="img"></p> <h2 id="性能提升"><a href="#性能提升" class="header-anchor">#</a> 性能提升</h2> <p>打包大小减少 41%（支持 vite 打包工具，使得打包速度更快）</p> <p>初次渲染快 55%，更新渲染快 133%</p> <p>内存减少 54%</p> <p><strong>使用 Proxy 代替 defineProperty 实现数据响应式</strong></p> <p><strong>重写虚拟DOM的实现和Tree-Shaking</strong></p> <h2 id="打包优化"><a href="#打包优化" class="header-anchor">#</a> 打包优化</h2> <blockquote><p>​	Vue 3通过支持ES模块导入、利用Tree Shaking、移除不常用的特性以及拆分内部逻辑与懒加载等多种方式，实现了对打包体积的有效控制，提升了应用的加载速度和性能。</p></blockquote> <ul><li>精确实现按需引入，减小打包体积：<strong>支持 ES 模块导入</strong>，使得打包工具可以静态分析模块依赖性并删除未使用的导出相关的代码。<strong>采用函数式编程</strong>，使得Vue3支持更好的Tree Shaking，在模板中实际使用了该功能时才导入该功能的帮助程序，可以过滤不使用的模块和没有使用到的组件。在Vue3中，任何一个函数，如ref、reactive、computed等，仅仅在用到的时候才打包，没用到的模块都被摇掉，打包的整体体积变小。而在 Vue2 中很多方法都是直接挂载在实例上，即使它们没有被显式使用，也可能会被打包进最终的构建产物中，导致体积增加</li> <li><strong>移除</strong>了一些在 Vue2中存在但<strong>不常用的特性</strong>（如 filters过滤器，推荐使用计算属性或方法来实现相同的功能），有助于减小Vue 3核心库的体积，使得最终打包的应用更加轻量</li> <li><strong>拆分内部逻辑与懒加载</strong>，对内部逻辑进行了更细致的拆分，并采用了懒加载的策略。只有当某个功能或组件被实际使用时，其对应的代码才会被加载和执行，有助于减少应用的初始加载时间，因为用户不需要等待所有功能都加载完成才能开始使用应用</li></ul> <h2 id="treeshaking"><a href="#treeshaking" class="header-anchor">#</a> TreeShaking</h2> <blockquote><p>Vue3采用了ES模块（ESM）作为主要的打包和分发格式，这使得它能够充分利用现代JavaScript打包工具（如Webpack、Rollup等）的Tree Shaking功能。</p> <p>Tree Shaking可以移除JavaScript中未引用的代码，Vue3的API设计更加模块化，很多功能如<code>ref</code>、<code>reactive</code>、<code>computed</code>等都是通过函数式API提供的，只有在被实际引用时才会被包含进最终的打包文件中。这种设计显著减少了最终打包体积，因为它去除了那些未被实际使用的代码。</p></blockquote> <p>​	Tree Shaking是一个术语，用于描述通过静态分析找出项目中未使用的代码（死代码）并将其从最终打包文件中排除的过程。</p> <ul><li>工作原理：</li></ul> <p>① 静态分析：分析项目代码，利用ES6模块的静态结构特性，确定哪些模块和函数被实际使用。</p> <p>②删除未使用代码：在打包过程中，删除未被使用的代码，只保留实际需要的部分。</p> <ul><li>让Tree-shaking生效的必要条件：使用ES6模块（import/export）；代码需静态，避免动态导入和执行；尽量使用纯函数和表达式，减少副作用。</li></ul> <p>​	在Vue 2中，许多功能（如指令、混入、过滤器等）是直接绑定到Vue实例或全局的，这导致即使这些功能在应用中未被使用，它们也可能被打包进最终的构建文件。而在Vue 3中，这些功能大多被设计为可按需引入的ES模块，使得Tree Shaking能够更有效地工作。</p> <p><strong>Vue2中的Tree Shaking</strong>：</p> <ul><li>源代码是使用CommonJS模块格式编写的，这种格式不支持现代打包工具（如Webpack或Rollup）的Tree Shaking功能。</li> <li>这意味着，无论Vue项目中实际使用了哪些Vue特性，最终打包时都会包含Vue的整个库，包括那些未使用的部分。</li></ul> <p><strong>Vue3中的Tree Shaking</strong>：</p> <ul><li>源代码被重写为使用ES Modules（ESM）格式，这是一种支持Tree Shaking的模块格式。</li> <li>使用ES Modules，现代打包工具能够分析代码，并只包含那些实际被项目引用的Vue特性和组件，从而移除未使用的代码（即“死代码”）。</li> <li>这种改进有助于减少最终打包文件的大小，加快应用的加载速度，提升用户体验。</li></ul> <h2 id="编译优化"><a href="#编译优化" class="header-anchor">#</a> 编译优化</h2> <blockquote><p>​	Vue3的编译器也进行了优化，以生成更高效、更轻量的代码，意味着编译后的代码体积更小，执行速度更快。例如，Vue 3的编译器会尝试识别并优化静态内容，以减少运行时的工作量。还引入了一些新的编译时特性，如Teleport和Fragments，这些特性在编译时就被处理，从而减少了运行时的开销。</p> <p>​	Proxy 惰性响应式、静态提升、静态节点标记、动态追踪、PatchFlag 标记、diff 双端比较的优化、使用 Block tree、事件监听缓存优化</p></blockquote> <ul><li><p><strong>静态模板提升</strong>：Vue 3在编译过程中会将模板中的静态内容（即在组件的整个生命周期内不会发生变化的部分）提升为常量，避免在每次渲染时重复创建相同的内容。这种优化减少了运行时的开销，提高了渲染性能。</p></li> <li><p><strong>PatchFlags</strong>：采用 PatchFlags来标记模板中的动态节点，帮助Vue在更新DOM时更加高效地定位和处理变化。当模板中的数据发生变化时，Vue会使用虚拟DOM进行比对，但PatchFlags允许Vue跳过那些没有发生变化的节点，直接更新发生变化的节点，从而减少了不必要的DOM操作。</p></li> <li><p><strong>Block Tree</strong>：采用 BlockTree 进行动态追踪和靶向更新，使用BlockTree来更高效地处理动态内容的更新，通过将模板划分为多个块（Block），可以更精确地定位并更新发生变化的DOM部分，避免在更新过程中对整个DOM树进行不必要的遍历和比对，从而提高了更新性能。</p></li></ul> <h2 id="静态节点的优化"><a href="#静态节点的优化" class="header-anchor">#</a> 静态节点的优化</h2> <p>​	Vue3对Vue2进行了多方面的升级，其中在静态节点优化方面，引入了静态提升和静态节点标记等机制，以显著提高渲染性能和效率。同时，Vue3也支持服务端渲染（SSR），进一步优化了应用的整体性能。</p> <h3 id="静态提升"><a href="#静态提升" class="header-anchor">#</a> 静态提升</h3> <p>​	vue2无论元素是否参与更新，每次都会重新创建然后再渲染。vue3对于不参与更新的元素，会做静态提升，只会被创建一次，在渲染时直接复用即可。</p> <blockquote><p>​	在Vue2中，模板中的每个插值表达式（如<code></code>）和指令（如<code>v-if</code>、<code>v-for</code>）都会在每次组件重新渲染时被动态解析和计算，无论模板的哪一部分是否实际发生了变化。而Vue3的编译器会静态分析模板，识别出哪些部分是静态的，并通过静态提升技术将其提升到编译阶段，作为常量或静态VNode（虚拟节点）存储在生成的渲染函数中，使得这些部分在组件的每次渲染中都不会被重新计算和创建。</p></blockquote> <p>​	Vue 3的编译器会检查模板中的节点，如果节点是纯静态的（即没有绑定任何动态数据或指令），那么这些节点就会被提升到render函数外部，并生成一个静态节点树。在渲染时，这些静态节点树可以直接被复用，而无需重新计算或渲染。通过静态提升可以避免每次渲染的时候都要重新创建这些对象，从而大大提高了渲染效率。</p> <p>​	<em>举个例子：</em></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>你好呀<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	<em>没有做静态提升之前：</em></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span>_Fragment<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;你好呀&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token comment">/* STABLE_FRAGMENT */</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	<em>做了静态提升后：</em></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;你好呀&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span>_Fragment<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    _hoisted_1<span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token comment">/* STABLE_FRAGMENT */</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Check the console for the AST</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​	<em>静态内容hosted_1被放置在render函数外，每次渲染的时候只要取hosted_1即可，同时hosted_1被打上PatchFlag,静态标记为-1，特殊标记是负整数表示永远不会用于Diff</em></p> <ul><li><p>作用：</p> <p>​	Vue3<strong>在编译时会对模板进行静态分析，不参与更新的元素会做静态提升，并在渲染过程中缓存起来，只会被创建一次，在后续的渲染过程中直接复用，避免了重复创建节点</strong>，大型应用会受益于这个改动，免去重复的创建操作，优化了运行时候的内存占用</p> <ul><li>减少渲染时间：静态内容只会被创建一次，并在后续的渲染中直接复用，避免在每次渲染时重新计算和创建静态部分，显著提高了渲染性能</li> <li>优化内存使用：静态内容被存储在JavaScript堆内存中，而不是在DOM树中，有助于减少内存占用。静态部分只会被创建一次并存储在内存中，避免了在多次渲染中重复创建相同节点的开销</li> <li>提升代码清晰度：优化后的渲染函数更加简洁，去除了大量重复的静态内容生成代码。</li> <li>减少了render函数的复杂性和执行成本，因为静态节点不需要在每次渲染时都重新计算或创建</li></ul></li></ul> <h3 id="静态节点标记"><a href="#静态节点标记" class="header-anchor">#</a> 静态节点标记</h3> <p>​	在编译阶段，Vue 3的编译器会根据模板的静态结构和动态绑定等信息，通过PatchFlag对模板中的节点进行静态标记。被标记为静态的节点在后续的渲染过程中会被视为不需要重新渲染的节点，在运行时，diff算法可以跳过静态节点的比较和更新，直接复用它们，从而避免不必要的计算和DOM操作。这样，只有动态节点才会在数据变化时触发重新渲染，从而提高了渲染性能。</p> <p><img src="/vivien-blog/assets/img/image-20240720085552691.7d91f61c.png" alt="image-20240720085552691"></p> <blockquote><p>​	在编译过程中，Vue3会对模板中的节点<strong>进行静态与动态的区分标记</strong>，这实际上是<strong>通过Patch Flag</strong>等技术手段实现的。</p> <p><strong>Patch Flag</strong>：巧妙结合 <code>runtime</code> 与 <code>compiler</code> 实现靶向更新和静态提升。</p> <ul><li>Vue 3在虚拟DOM节点上引入了Patch Flag，这些标记用于指示节点的某些部分在渲染过程中是否会发生变化。通过这种方式，Vue 3可以减少不必要的DOM比较和更新操作，仅对发生变化的部分进行渲染，从而进一步提高渲染效率。</li> <li><code>patchFlag</code> 是 <code>complier</code> 时的 <code>transform</code> 阶段解析 AST Element 打上的<strong>优化标识</strong>。并且，顾名思义 <code>patchFlag</code>，<code>patch</code> 一词表示着它会为 <code>runtime</code> 时的 <code>patchVNode</code> 提供依据，从而实现靶向更新 <code>VNode</code> 的效果。</li></ul> <p><img src="/vivien-blog/assets/img/view.172d76f5.png" alt="preview"></p> <p>​	值得一提的是整体上 <code>patchFlag</code> 的分为两大类：</p> <p>① 当 <code>patchFlag</code> 的值<strong>大于</strong> 0 时，代表所对应的元素在 <code>patchVNode</code> 时或 <code>render</code> 时是可以被优化生成或更新的。</p> <p>② 当 <code>patchFlag</code> 的值<strong>小于</strong> 0 时，代表所对应的元素在 <code>patchVNode</code> 时，是需要被 <code>full diff</code>，即进行递归遍历 <code>VNode tree</code> 的比较更新过程。</p></blockquote> <ul><li><strong>目的</strong>：优化虚拟DOM的渲染过程，将模板中的静态节点与动态节点进行区分，以便在后续的渲染过程中跳过不必要的虚拟DOM对比和渲染操作，仅对动态节点进行渲染</li> <li><strong>实现</strong>：根据模板的静态结构和动态绑定信息，编译器对节点进行静态标记，以便在渲染过程中进行高效处理</li></ul> <h3 id="ssr优化"><a href="#ssr优化" class="header-anchor">#</a> SSR优化</h3> <p>​	服务端渲染（SSR）是指将页面的渲染工作从客户端转移到服务器端，由服务器根据请求动态生成HTML页面并发送给客户端。Vue2 中也是有 SSR 渲染的，但是 Vue3 中的 SSR 渲染相对于 Vue2 来说，性能方面也有对应的提升。</p> <ul><li>当存在大量静态内容时，这些内容会被当作纯字符串推进一个 buffer 里面，即使存在动态的绑定，会通过模版插值潜入进去。这样会比通过虚拟 dmo 来渲染的快上很多。</li> <li>当静态内容大到一定量级，会用<code>_createStaticVNode</code>方法在客户端去生成一个 static node，这些静态 node，会被直接 innerHtml，就不需要再创建对象，然后根据对象渲染。<code>_createStaticVNode</code>方法是一个内部 API，用于在编译时识别并标记那些不会变化的节点为静态节点，这些节点在服务器端渲染时会被直接转换为 HTML 字符串，并在客户端加载时通过 <code>innerHTML</code> 插入到 DOM 中，而无需创建虚拟 DOM 对象并进行复杂的渲染过程。通过减少客户端的渲染工作和资源消耗，显著提升了 SSR 和 SSG 应用的性能。</li></ul> <p>​	<em>举个例子：</em></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>你好呀<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	...  // 很多个静态属性
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	<em>编译后：</em></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeProps <span class="token keyword">as</span> _mergeProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ssrRenderAttrs <span class="token keyword">as</span> _ssrRenderAttrs<span class="token punctuation">,</span> ssrInterpolate <span class="token keyword">as</span> _ssrInterpolate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/server-renderer&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ssrRender</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">,</span> _push<span class="token punctuation">,</span> _parent<span class="token punctuation">,</span> _attrs<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _cssVars <span class="token operator">=</span> <span class="token punctuation">{</span> style<span class="token operator">:</span> <span class="token punctuation">{</span> color<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token function">_push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    <span class="token function">_ssrRenderAttrs</span><span class="token punctuation">(</span><span class="token function">_mergeProps</span><span class="token punctuation">(</span>_attrs<span class="token punctuation">,</span> _cssVars<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;div&gt;&lt;span&gt;你好呀&lt;/span&gt;...&lt;div&gt;&lt;span&gt;你好呀&lt;/span&gt;&lt;div&gt;&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    <span class="token function">_ssrInterpolate</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><p><strong>优点</strong></p> <p>更快的页面加载速度：由于初始HTML是在服务器端生成的，因此用户可以更快地看到页面内容
更好的SEO优化：搜索引擎可以更容易地抓取和索引服务器端渲染的页面内容，从而提升页面在搜索结果中的排名
减轻客户端负担：服务器端渲染可以减少客户端的渲染工作，降低客户端的资源消耗</p></li> <li><p>实现方式</p> <p>使用Nuxt.js：Nuxt.js是一个基于Vue.js的服务器端渲染框架，提供了完整的服务器端渲染解决方案，包括路由管理、数据预取、组件渲染等</p> <p>配置与部署：开发者可以根据Nuxt.js的文档进行项目配置和部署，方便地实现Vue应用的服务器端渲染，从而提高应用的性能和SEO表现</p></li></ul> <h2 id="动态节点的优化"><a href="#动态节点的优化" class="header-anchor">#</a> 动态节点的优化</h2> <blockquote><p>​	Vue3 通过引入Proxy对象、优化虚拟DOM算法、支持静态标记和静态提升、缓存事件侦听器以及支持Fragment和Teleport等特性，实现了对动态节点的更高效优化。这些优化措施不仅提高了Vue应用的性能，还使得开发者能够更加方便地构建和维护Vue应用。</p></blockquote> <h3 id="动态追踪"><a href="#动态追踪" class="header-anchor">#</a> 动态追踪</h3> <p>​	在Vue3中，动态追踪主要依赖于其响应式系统的改进。Vue3引入了Proxy对象来替代Vue2中的Object.defineProperty，以实现更加高效的响应式数据追踪。</p> <ol><li>Proxy的优势：
<ul><li><strong>全局拦截</strong>：Proxy可以拦截对象属性的读取、设置、删除等多种操作，而不仅仅是属性的值变化。这使得Vue3能够更全面地追踪数据的变化。</li> <li><strong>性能提升</strong>：由于Proxy是代理整个对象，而不是像Object.defineProperty那样逐个属性地设置getter和setter，因此Vue3在初始化响应式对象时更加高效。</li> <li><strong>支持数组和Map/Set等数据结构</strong>：Proxy能够拦截数组和Map/Set等复杂数据结构的操作，使得Vue3能够更好地处理这些数据结构的变化。</li></ul></li> <li>动态追踪的实现：
<ul><li>当Vue3组件中的响应式数据发生变化时，Proxy会拦截到这些变化，并通知Vue的渲染系统重新渲染相关的组件。</li> <li>Vue3的渲染系统会根据变化的数据和组件的依赖关系，智能地确定需要重新渲染的组件部分，从而实现高效的动态追踪。</li></ul></li></ol> <h3 id="动态节点标记"><a href="#动态节点标记" class="header-anchor">#</a> 动态节点标记</h3> <p>​	在Vue3中，虽然没有直接提及“动态节点标记”这一概念，但Vue3通过优化其虚拟DOM算法和渲染机制，实现了对动态节点的更高效处理。</p> <ol><li>虚拟DOM的优化：
<ul><li><strong>静态标记（Patch Flag）</strong>：Vue3在虚拟DOM节点上引入了静态标记（Patch Flag），这些标记用于指示节点的某些部分在渲染过程中是否会发生变化。通过这种方式，Vue3可以减少不必要的DOM比较和更新操作，提高渲染性能。</li> <li><strong>静态提升（Hoist Static）</strong>：对于不参与更新的静态节点，Vue3会在初始化时创建一次，并在后续的渲染过程中复用这些节点，而不是每次都重新创建。不仅减少了不必要的DOM操作，还优化了内存使用。</li></ul></li> <li>事件侦听器缓存：
<ul><li>Vue3还优化了事件侦听器的处理机制。默认情况下，Vue会将事件侦听器视为动态绑定，并在每次渲染时都追踪其变化。但是，如果事件侦听器函数在多次渲染中保持不变，Vue3会将其缓存起来并复用，以减少不必要的性能开销。</li></ul></li> <li>Fragment和Teleport的支持：
<ul><li>Vue3还支持Fragment（多根节点组件）和Teleport（跨组件渲染），这些特性使得开发者可以更加灵活地构建组件，并在一定程度上优化动态节点的渲染和布局。</li></ul></li></ol> <h2 id="运行时优化"><a href="#运行时优化" class="header-anchor">#</a> 运行时优化</h2> <ul><li><strong>事件侦听器缓存</strong>：当组件重新渲染时，如果事件处理器（即绑定到元素上的函数）没有发生变化，Vue 3会复用之前的事件监听器，而不是重新创建。这种缓存机制减少了DOM操作的次数，并降低了内存消耗，从而提高了事件处理的效率。</li> <li><strong>组件实例缓存</strong>：Vue 3的<code>&lt;keep-alive&gt;</code>组件提供了一种缓存组件实例的方式。当组件被包裹在<code>&lt;keep-alive&gt;</code>中时，其状态或实例在组件切换时会被保留而不是被销毁。这意味着当组件再次被需要时，Vue可以快速地恢复其状态，而无需重新创建和初始化组件。这对于那些开销较大或需要频繁切换的组件来说，可以显著提高应用的性能和响应速度。</li> <li><strong>异步组件</strong>：开发者可以定义一个异步组件，该组件在需要时才会加载其定义。这有助于减少应用的初始加载时间，因为用户只需要加载当前路由或视图中所需的组件。此外，当应用规模增大时，异步组件还可以帮助将代码拆分成更小的块，以便更好地进行管理和维护。</li> <li><strong>代码拆分</strong>：Vue 3与Webpack等现代前端构建工具紧密集成，支持自动的代码拆分和懒加载。这意味着开发者可以将应用拆分成多个路由或功能块，并在用户访问相应页面或功能时按需加载它们。这种技术显著减少了应用的初始加载时间，并提高了应用的响应性和可用性。</li></ul> <h2 id="事件监听缓存优化"><a href="#事件监听缓存优化" class="header-anchor">#</a> 事件监听缓存优化</h2> <p>​	在Vue3中，当组件被创建时，其内部会缓存特定类型的事件处理器。这意味着，如果你在组件的模板或方法中为某个元素（如<code>window</code>或<code>document</code>）绑定了事件监听器（如<code>@scroll</code>或<code>@resize</code>），Vue3会确保这些监听器只被创建一次，并在组件的整个生命周期内重用，避免了在每次组件渲染时都重新创建和销毁事件监听器的情况。默认情况下，当组件重新渲染时，如果事件监听器（如<code>@click</code>）<strong>绑定在同一个元素上且监听函数没有变化</strong>，Vue会<strong>尽量重用</strong>现有的事件监听器而不是重新添加。但在某些情况下，如果监听器函数本身发生了变化（例如，你绑定了一个计算属性或方法作为监听器，并且这个计算属性或方法的返回值在每次渲染时都不同），那么Vue可能需要重新添加监听器。</p> <p>​	<em>举个例子：</em></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">'</span>onClick<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>点我点点点点<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	<em>没开启事件监听器缓存：</em></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_withId</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> onClick<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>onClick <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;点我点点点点&quot;</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token comment">/* PROPS */</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;onClick&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                             <span class="token comment">// PROPS=1&lt;&lt;3,// 8 //动态属性，但不包含类名和样式</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	<em>开启事件监听器缓存：</em></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      onClick<span class="token operator">:</span> _cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;点我点点点点&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​	<em>开启缓存后，没有了静态标记，也就是说下次diff算法的时候直接使用，因为在Vue3的diff算法中，只有有静态标记的才会进行比较，才会进行追踪</em></p> <ul><li>事件处理器缓存：Vue 3内部优化了事件处理器的缓存机制，确保相同的事件处理器在组件多次渲染时只被创建一次，避免了不必要的重复创建和销毁，从而减少了内存使用和垃圾回收的开销。</li> <li>自动清理：当组件被销毁时，Vue 3会自动清理与该组件相关的所有事件监听器，防止内存泄漏。这种自动化的清理机制简化了开发者的工作，减少了出错的可能性。</li> <li>性能提升：通过减少事件处理器的创建和销毁频率，Vue 3应用能够更快地响应用户交互，特别是在处理高频事件时，如滚动、拖拽等，提升了应用的性能和用户体验。</li> <li>简化开发：开发者不再需要在组件销毁时手动移除事件监听器，Vue 3的自动管理机制让代码更加简洁和易于维护。</li></ul> <h2 id="虚拟dom优化"><a href="#虚拟dom优化" class="header-anchor">#</a> 虚拟DOM优化</h2> <ul><li><strong>静态标记（Static Marking）</strong>：Vue 3在虚拟DOM中使用了静态标记来跳过静态节点的比对和更新，进一步减少了不必要的操作。</li> <li><strong>更快的Diff算法</strong>：Vue 3的Diff算法在保持原有功能的基础上，进行了多项优化，以减少不必要的遍历和计算。例如，通过PatchFlags等机制，Vue 3能够更精确地定位到需要更新的节点，并只对这些节点进行更新操作，从而避免了对整个DOM树的全面遍历和比对。这种更高效的Diff算法使得Vue 3在处理大型应用或复杂场景时，能够保持出色的渲染性能。</li></ul> <h2 id="重写-diff-算法"><a href="#重写-diff-算法" class="header-anchor">#</a> 重写 diff 算法</h2> <blockquote><p><code>diff</code> 过程在一定程度上是减少了对 <code>DOM</code> 的直接操作。但是，<strong>这个减少是有一定成本的</strong>。因为，如果是复杂应用，那么就会存在父子关系非常复杂的 <code>VNode</code>，而这也就是 <code>diff</code> 的痛点，它会不断地递归调用 <code>patchVNode</code>，不断堆叠而成的几毫秒，最终就会造成 <code>VNode</code> 更新缓慢。</p> <p>这也是为什么我们所看到的大型应用诸如阿里云之类的采用的是基于「React」的技术栈的原因之一。</p> <p>Vue3也是痛改前非，重写了整个 <code>Compiler</code> 过程，提出了静态提升、靶向更新等优化点，来提高 <code>patchVNode</code> 过程。</p></blockquote> <p>​	Vue2中的虚拟dom是全量的对比（每个节点不论写死的还是动态的都会一层一层比较，浪费了大部分事件在对比静态节点上），其核心目的是通过最小化对真实DOM的操作来提高性能。基于两个树（旧树和新树）的递归比较算法。</p> <p>​	Vue3新增了静态标记，为会发生变化的地方添加一个 flag 标记，下次发生变化的时候，与上次虚拟节点对比时，只对比带有patch flag的节点（动态数据所在的节点）；可通过flag信息得知当前节点要对比的具体内容，只对动态节点部分进行diff运算，减少了资源的损耗。 采用<strong>同序列比对</strong>和<strong>最长递归子序列</strong>的算法来计算出最小的修改偏移量。</p> <p>​	diff 算法升级的一些关键点：</p> <ol><li><p><strong>静态提升</strong>：Vue 3 的编译器在编译阶段（或预处理阶段）会分析模板，将在渲染过程中不会发生变化的静态内容（如纯 HTML）提升出渲染函数，这样在每次渲染时就不会重新创建这些静态节点，从而节省性能。</p></li> <li><p><strong>静态标记</strong>：与静态提升类似，Vue 3 还会对模板进行静态标记，将静态节点和动态节点进行区分。在 diff 算法中，Vue 3 可以跳过对静态节点的比较和更新，直接复用之前的 DOM 节点，减少了不必要的操作。</p></li> <li><p><strong>块树</strong>：引入了块树的概念，将模板编译成更小的单元（块），这些块可以独立地更新。这有助于减少每次渲染时需要重新比较的 DOM 数量。</p></li> <li><p><strong>Patch Flags</strong>：使用了 Patch Flags 来标记一个节点可能需要更新的类型（如属性、文本、子节点等）。这些标志在运行时被用来指导 diff 过程，从而只关注实际发生变化的部分，并跳过那些未改变的部分。</p></li> <li><p><strong>Fragments 优化</strong>：在 Vue 2 中，Fragments（片段）会引入额外的虚拟 DOM 层级，导致 diff 算法需要进行更多的比较操作。而在 Vue 3 中，对 Fragments 进行了优化，可以直接将其内部的内容合并到父级中，减少了虚拟 DOM 层级，提高了 diff 算法的效率。</p></li> <li><p><strong>动态属性的快速路径</strong>：通过快速路径优化了动态属性的处理。对于动态属性，Vue 3 会使用更快速的路径进行处理，减少了比较的开销，提高了 diff 算法的性能。</p></li> <li><p><strong>缓存优化</strong>：通过缓存事件处理器、计算属性等方式，避免了每次更新时重新计算或创建事件处理函数，减少了内存消耗和性能开销。</p></li> <li><p><strong>更智能的子节点比对</strong>：在 Vue 2 中，子节点的比对是基于索引的，这可能导致即使子节点的内容没有变化，只要它们的顺序发生了变化，就会触发大量的 DOM 更新。Vue 3 改进了这一点，它使用 <code>key</code> 来更智能地比对和移动 DOM 元素，减少了因节点顺序变化而导致不必要的额外 DOM 操作。</p></li> <li><p><strong>双端对比策略</strong>：Vue 3 的 diff 算法采用了双端对比的方式，它会同时从新节点和旧节点的两端进行对比，以尽可能少地进行操作来更新 DOM。这种策略有助于减少不必要的 DOM 变动，提高渲染效率。</p></li> <li><p><strong>编译器优化</strong>：Vue 3 的编译器进行了大量的优化，生成更高效、更轻量的渲染函数。这些优化包括代码拆分、作用域提升、条件表达式优化等，都有助于提高 diff 过程的效率。</p></li> <li><p><strong>源码实现</strong>：在 Vue 3 的源码中，diff 算法的实现主要集中在 <code>packages/runtime-core/src/renderer.ts</code> 文件中的 <code>patch</code> 函数及其相关辅助函数中。这些函数负责实际的 DOM 更新操作，并根据 Patch Flags 和其他信息来决定是否需要进行更新。</p></li></ol> <h2 id="源码层面"><a href="#源码层面" class="header-anchor">#</a> <strong>源码层面</strong></h2> <ul><li><p>vue2</p> <ol><li>源码作为一个整体的项目来管理，虽然内部通过目录结构对不同的功能模块（如核心库、编译器、模板编译器、服务器渲染器等）进行了逻辑上的划分，但这些模块在开发和维护时仍紧密关联于同一个仓库。</li> <li>在 Javascript 中使用 flow 进行静态类型检测，但它对一些复杂场景的支持相对较弱，可能导致类型检查不够准确或完整。</li></ol></li> <li><p>vue3</p> <ol><li>整个源码通过 <code>monorepo</code>单体仓库的方式维护，即将多个独立的项目（或包）放在同一个仓库中管理。根据功能将不同模块拆分到<code>packages</code>目录下面不同的子目录中，package（如 <code>reactivity</code> 响应式库、<code>runtime-core</code>、<code>runtime-dom</code>、<code>compiler-core</code> 等）可以独立于 Vue 使用。</li> <li>使用typescript进行重构，对typescript支持更友好，提供了完整的类型定义，能够在编写 Vue 应用时享受到静态类型检查带来的好处，可以在编译阶段发现并修复许多潜在的错误，从而减少运行时错误的发生。TypeScript 的自动补全、错误提示等功能能够显著提升开发者的开发效率和体验。</li></ol></li></ul> <h2 id="新增特性-组件"><a href="#新增特性-组件" class="header-anchor">#</a> 新增特性/组件</h2> <h3 id="fragment-文档碎片-片段"><a href="#fragment-文档碎片-片段" class="header-anchor">#</a> Fragment - 文档碎片（片段）</h3> <p>​	在 Vue2 中: 组件有且仅有一个根标签，当用户意外创建多根组件时会发出警告，为了修复此错误，许多组件被包装在一个<code>&lt;div&gt;</code>中。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- Vue2 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​	在 Vue3 中: <strong>允许组件有多个根节点</strong>，Vue将为我们创建一个虚拟的Fragment节点，将多个标签包含在里面</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- Vue3 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> 多读书多看报 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> 少吃零食多睡觉 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>在Suspended-component完全渲染之前，备用内容会被显示出来。</p> <p>如果是异步组件，Suspense可以等待组件被下载，或者在设置函数中执行一些异步操作。</p> <p>多个根节点上的 Attribute 继承：需要显式定义 attribute 应该分布在哪里，否则控制台会给出警告提示。</p></blockquote> <p>​	优点：减少标签层级, 减小内存占用</p> <ol><li>允许在Vue模板中返回多个元素，而无需添加额外的包裹元素(不再需要根标签)</li> <li>可以将多个元素作为Fragment的子元素来返回，并且Fragment本身不会被渲染到DOM中，避免引入不必要的父元素，减少标签层级，使得模板结构更加清晰， 减小内存占用</li></ol> <h3 id="teleport-瞬移组件的位置-传送"><a href="#teleport-瞬移组件的位置-传送" class="header-anchor">#</a> Teleport - 瞬移组件的位置（传送）</h3> <blockquote><p>Teleport 提供了一种干净的方法，让组件的 html 在父组件界面外的特定标签(很可能是 body)下插入显示</p></blockquote> <ol><li>可以将组件的内容渲染到指定 DOM 节点，<strong>允许将组件模板中的一部分HTML“传送”到DOM中的另一个位置</strong>，只改变了渲染的 DOM 结构，不会影响组件间的逻辑关系，一般用于创建全局弹窗和对话框等组件</li> <li>允许我们将子元素渲染到DOM树的指定位置，而不是直接在当前组件的模板中渲染，对于需要在组件外的指定元素中渲染内容（比如弹出层、模态框等）非常有用，可以使用Teleport组件的to属性来指定目标元素的选择器或DOM节点</li></ol> <h3 id="suspense-异步加载组件的-loading-界面-不确定的"><a href="#suspense-异步加载组件的-loading-界面-不确定的" class="header-anchor">#</a> Suspense - 异步加载组件的 loading 界面（不确定的）</h3> <blockquote><p><strong>允许组件在等待异步组件时渲染备用内容</strong>，可以让我们创建一个平滑的用户体验</p></blockquote> <ol><li>提供了更优雅的方式来处理异步加载的组件，允许指定加载中和加载完成时渲染不同的内容</li> <li>允许在异步加载组件时显示一个占位符，直到组件加载完成，这个占位符可以是一个自定义的loading组件或者其他内容，当异步组件加载完成后，Suspense组件会自动替换占位符为实际组件</li></ol> <ul><li><p>Composition (组合) API</p> <ul><li>setup配置</li> <li>ref 和 reactive</li> <li>watch与watchEffect</li> <li>provide 与 inject</li> <li>…</li></ul></li> <li><p>新的生命周期函数</p></li> <li><p>其它 API 更新</p> <ul><li>新的API：<strong>Vue3 使用 createApp 方法来创建应用程序实例，并有新的组件注册和调用方法</strong></li> <li><strong>emits</strong>属性：Vue3 的组件可以使用 emits 属性来声明事件</li> <li><strong>新增了异步组件的写法</strong>：<code>const Foo = defineAsyncComponent(() =&gt; import('./Foo.vue') )</code></li> <li>全局 API 的修改</li> <li>将原来的全局 API 转移到应用对象</li> <li>模板语法变化</li></ul></li></ul> <h3 id="自定义渲染api"><a href="#自定义渲染api" class="header-anchor">#</a> 自定义渲染API</h3> <p>​	Vue2.x 项目架构对于 Weex（移动端跨平台方案）和 myvue（小程序上使用）等渲染到不同平台（跨平台渲染）不太友好，因为 Vue 2.x 的核心是为 Web 平台设计的，不同平台有不同的运行时环境和渲染机制，而 Vue 2.x 的核心库并没有直接支持这些差异。</p> <p>​	Vue3.X 推出了自定义渲染API（也称为运行时核心或 <code>@vue/runtime-core</code>），允许开发者编写与平台无关的 Vue 代码，并通过不同的渲染器将这些代码转换为特定平台可以理解的格式，解决了该问题。</p> <p>​	下面，我们先来看看Vue2和Vue3的入口文件写法有哪些不同。</p> <p>​	Vue2：入口文件通常使用<code>new Vue({...})</code>来创建Vue实例，并挂载到DOM元素上。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">render</span><span class="token operator">:</span> h <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	Vue3：引入了<code>createApp</code>函数，这个函数接受根组件作为参数，并返回一个应用实例，该实例提供了<code>.mount()</code>方法来挂载应用。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./src/App&quot;</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token comment">// 注意：对于非 Web 平台，你不会直接这样写，而是会使用相应的框架或插件提供的 API</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​	Vue 官方提供的 <code>createApp</code> 函数默认是为 Web 平台设计的，它使用 Vue 的 DOM 渲染器将 Vue 组件的模板 template 映射并渲染成 HTML 代码。如果你希望将 Vue 组件渲染到非 HTML 元素上，比如 canvas，那么就需要使用一个自定义渲染器（Custom Renderer API）来定义自己的 render 渲染生成函数了。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./runtime-render&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 自己编写的为特定平台（如 Weex 或小程序）定制的，并且已经包含了必要的渲染逻辑和适配器</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./src/App&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 根组件</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	使用自定义渲染API来构建跨平台应用，如Weex和myvue这类方案的问题就得到了完美解决，只需重写createApp（不推荐）即可。</p> <p>​	实际上，对于Weex和小程序等特定平台，Vue社区已经提供了相应的框架或插件（如 Weex 自身的 Vue 运行时，Uni-app、MPVue等），这些框架已经内置了对这些平台的支持，并允许开发者以Vue的方式编写代码，而无需直接处理自定义渲染器（底层渲染逻辑）。</p> <blockquote><h3 id="示例-重写createapp以支持自定义渲染"><a href="#示例-重写createapp以支持自定义渲染" class="header-anchor">#</a> 示例：重写<code>createApp</code>以支持自定义渲染</h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 假设你有一个自定义渲染器createCustomRenderer  </span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue/runtime-core'</span><span class="token punctuation">;</span> <span class="token comment">// 注意：这是Vue内部API的简化表示  </span>
  
<span class="token comment">// 自定义渲染器配置  </span>
<span class="token keyword">const</span> customRenderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
  <span class="token comment">// ... 实现你的渲染逻辑  </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 封装createApp以使用自定义渲染器  </span>
<span class="token keyword">function</span> <span class="token function">createCustomApp</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
  <span class="token comment">// 这里可以扩展app实例，添加自定义方法或属性  </span>
  <span class="token comment">// 或者直接使用自定义渲染器挂载应用  </span>
  <span class="token comment">// 注意：这里只是一个概念示例，实际实现可能会有所不同  </span>
  <span class="token comment">// app.mount = (container) =&gt; {  </span>
  <span class="token comment">//   customRenderer.mount(rootComponent, container);  </span>
  <span class="token comment">// };  </span>
  
  <span class="token comment">// 由于Vue 3的createApp不直接支持更换渲染器，  </span>
  <span class="token comment">// 你可能需要在挂载时直接使用自定义渲染器的mount方法  </span>
  <span class="token comment">// 或者通过插件/mixin等方式在Vue应用中注入自定义行为  </span>
  
  <span class="token comment">// 返回扩展后的app实例（或直接使用自定义挂载逻辑）  </span>
  <span class="token keyword">return</span> app<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// 使用自定义的createCustomApp  </span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./src/App&quot;</span><span class="token punctuation">;</span>  
<span class="token function">createCustomApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意：这里的mount可能需要替换为自定义的挂载逻辑</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>注意</strong>：上面的代码是一个概念性的示例，用于说明如何结合Vue 3和自定义渲染逻辑。实际上，Vue 3的<code>createApp</code>函数并不直接支持更换渲染器，因此你可能需要采取其他方式（如插件、mixin或直接在Vue组件内部处理）来将Vue组件树映射到你的自定义渲染环境中。</p></blockquote> <h2 id="语法api不同"><a href="#语法api不同" class="header-anchor">#</a> 语法API不同</h2> <ul><li><p>Vue2：</p> <ul><li>选项式API，面向对象编程。OptionsAPI 在options里写data,methods,created等描述组件对象，多个逻辑可能在不不同地方，代码内聚性低</li> <li>逻辑复用：使用mixins进行代码逻辑共享，mixins也是由一大堆options组成，如果有多个mixins则可能造成命名冲突等问题，还会导致依赖关系不清晰</li> <li>集中化管理：Vuex通过集中式存储管理应用的所有组件状态，具有state、mutations、actions等核心概念</li> <li>异步操作：通常在Vuex的actions中处理异步操作，actions支持返回Promise，但组件内部的异步操作可能较为分散</li> <li>只支持一个根节点 ，在模板中如果使用多个根节点时会报错</li> <li>无法单独使用部分模块</li> <li>使用<code>new Vue()</code>创建实例同一个 Vue 构造函数创建的每个根实例共享相同的全局配置，因此全局 API 影响所有 vue 实例</li> <li>组件注册方式：使用<code>Vue.component(tagName, options)</code>方法进行全局注册，在Vue实例的<code>components</code>选项中进行局部注册</li></ul></li> <li><p>Vue3：</p> <ul><li>选项式API/组合式API，引入了Composition APl，可以将同一逻辑功能代码写在同一片区域，而不是分散在各个options里，更高效地组织和复用逻辑代码</li> <li>逻辑复用：支持将一部分独立可复用的逻辑代码抽离封装为特定功能函数（hook），使得组件之间逻辑的提取和重用变得更加简单，并避免命名冲突</li> <li>集中化管理：结合reactive、ref等API实现状态管理，或通过Pinia等库进行集中化管理</li> <li>异步操作：同样支持在Vuex的actions中处理异步操作，但更鼓励在组件内部直接使用async/await或Promise来处理异步操作，特别是在Composition API的<code>setup</code>函数中，这使得异步操作的处理更加直观和集中</li> <li>支持多个根节点，也就是 fragment，即可以直接在 template 中使用多个根级别的元素，而不需要额外的包装元素</li> <li>更注重模块上的拆分，模块之间耦合度低，可以独立使用，还对所有的 API 进行重写</li> <li>使用<code>createApp()</code>工厂函数创建实例，可以返回一个提供应用上下文的应用实例，不同的实例注册的组件无法在不同的实例下使用</li> <li>组件注册方式：通过<code>createApp</code>方法创建Vue应用实例，并使用该实例的<code>.component</code>方法进行全局注册，局部注册是在组件的<code>export default</code>选项中的<code>components</code>字段进行。<code>&lt;script setup&gt;</code> 提供了更简洁的编写方式，但组件的注册（无论是全局还是局部）仍然需要遵循Vue的注册机制</li> <li>面向函数编程，没有this，减少了this指向不明的情况，处处皆函数，会有更好的类型推断，当内部有异步函数，需要使用到await的时候，可以直接使用，不需要在setup前面加async</li></ul></li> <li><p>更好的TS支持</p> <ul><li><p>Vue2可能不适合使用TS，原因在于Vue2的Option API风格。**Options API是基于对象的结构，而TS是一种类型系统、面向对象的语法，两者有点不匹配。**在Vue2结合TS的具体实践中，要用 <code>vue-class-component</code> 强化 Vue 组件，让 Script 支持 TypeScript 装饰器，用 <code>vue-property-decorator</code> 来增加更多结合 Vue 特性的装饰器，最终导致 TS 的组件写法和 JS 的组件写法差异较大，增加了学习曲线。</p></li> <li><p>在Vue3中，量身打造了<code>defineComponent</code>函数，使组件在TS下可以更好地利用参数类型推断 。<strong>Composition API代码风格更加符合函数式编程和TS的类型系统</strong>，比较有代表性的api就是 ref 和 reactive，允许开发者显式地声明响应式数据的类型，从而提高了类型安全性和代码的可维护性。</p></li></ul></li> <li><p>v-model 的本质变化</p> <ul><li>prop：value --&gt; modelValue</li> <li>event：input --&gt; update:modelValue</li> <li>.sync 修改符已移除，由v-model代替</li> <li>v-if 优先 v-for 解析</li></ul></li></ul> <h2 id="组件通信的区别"><a href="#组件通信的区别" class="header-anchor">#</a> 组件通信的区别</h2> <ul><li>Vue3移出事件总线，使用mitt代替。</li> <li>vuex换成了pinia。</li> <li>把.sync优化到了v-model里面了。</li> <li>把$listeners所有的东西合并到$attrs中了。</li> <li>$children被砍掉了。</li></ul> <blockquote><ul><li><strong>Provide/Inject</strong>：在Vue 3中，<code>provide</code> 和 <code>inject</code> API 得到了改进，允许跨组件层级传递数据，而不仅仅是父子组件之间。</li> <li><strong>Composition API中的响应式引用</strong>：在Composition API中，可以通过<code>ref</code>和<code>reactive</code>等API来创建响应式数据，并通过<code>toRefs</code>或<code>setup</code>函数的返回值来暴露给模板或其他Composition API函数使用。</li></ul></blockquote> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <table><thead><tr><th>vue2</th> <th>vue3</th> <th>生命周期</th></tr></thead> <tbody><tr><td>beforeCreate()</td> <td>setup()</td> <td>组件开始创建数据实例之前</td></tr> <tr><td>created()</td> <td>setup()</td> <td>组件数据创建数据实例完成</td></tr> <tr><td>beforeMount()</td> <td>onBeforeAMount()</td> <td>DOM挂载之前</td></tr> <tr><td>mounted()</td> <td>onMounted()</td> <td>DOM挂载完成（页面完成渲染）</td></tr> <tr><td>beforeUpdate()</td> <td>onBeforeUpdate()</td> <td>组件数据更新之前</td></tr> <tr><td>undated()</td> <td>onUpdated()</td> <td>组件数据更新之后</td></tr> <tr><td>beforeDestroy()</td> <td>onBeforeunmount()</td> <td>组件销毁之前</td></tr> <tr><td>destroyed()</td> <td>onUnmounted()</td> <td>组件销毁之后</td></tr></tbody></table> <p><img src="/vivien-blog/assets/img/vue3Learning-1.5ccbe398.png" alt="Img"></p> <h3 id="vue2-x-的生命周期"><a href="#vue2-x-的生命周期" class="header-anchor">#</a> vue2.x 的生命周期</h3> <p><img src="/vivien-blog/assets/img/vue3Learning-2.6783c997.png" alt="Img"></p> <h3 id="vue3-0-的生命周期"><a href="#vue3-0-的生命周期" class="header-anchor">#</a> vue3.0 的生命周期</h3> <p><img src="/vivien-blog/assets/img/vue3Learning-3.b4ccff8d.png" alt="Img"></p> <h2 id="响应式系统"><a href="#响应式系统" class="header-anchor">#</a> 响应式系统</h2> <blockquote><p>​	vue2采用的是defineProperty来劫持整个对象，然后进行深度遍历所有属性，给每个属性添加gette、setter实现响应式；而vue3采用proxy重写响应式系统，因为proxy可以对整个对象进行监听，不需要深度遍历。</p></blockquote> <h3 id="数据劫持"><a href="#数据劫持" class="header-anchor">#</a> 数据劫持</h3> <ul><li>Vue 2 使用基于 Object.defineProperty 的响应式系统，不能检测对象属性的添加和删除，对于数组和对象的修改需要特定的方法来触发更新，对一个嵌套层级较深的对象，需要通过遍历来劫持它内部深层次的对象变化。</li> <li>Vue 3 使用Proxy 对象来实现响应式系统，支持更深层次的响应式，无需特定方法来触发更新，对深层嵌套对象进行惰性响应式（只有在数据被实际访问时才会进行响应式处理）。</li></ul> <blockquote><p>​	所谓的<strong>数据响应式</strong>就是建立响应式数据与依赖（调用了响应式数据的操作）之间的关系，当响应式数据发生变化时，可以通知那些使用了这些响应式数据的依赖操作进行相关更新操作，可以是DOM更新，也可以是执行一些回调函数。</p></blockquote> <table><thead><tr><th>特性</th> <th>Vue2</th> <th>Vue3</th></tr></thead> <tbody><tr><td>实现方式</td> <td>基于<code>Object.defineProperty</code></td> <td>基于<code>Proxy</code>对象</td></tr> <tr><td>依赖收集</td> <td>使用Watcher机制</td> <td>使用Proxy的拦截能力和依赖关系图</td></tr> <tr><td>新增/删除属性监听</td> <td>需要手动使用<code>Vue.set</code>或<code>this.$set</code></td> <td>自动监听</td></tr> <tr><td>数组变化监测</td> <td>有限支持（如直接修改索引值不触发更新）</td> <td>全面支持</td></tr> <tr><td>性能与灵活性</td> <td>相对较低，对复杂数据结构的支持有限</td> <td>更高，支持更复杂的数据结构和动态属性添加</td></tr></tbody></table> <p><strong>Object.defineProperty 实际上是 JavaScript 对象的一个内置方法，而 proxy 是针对整个对象及其所有基本方法的拦截器，这是最本质的区别！</strong></p> <ul><li><p>Vue2底层是通过 ES5 的 Object.defineProperty() 进行数据劫持，结合订阅发布的方式实现，有一定的局限性。性能差的原因是需要<strong>递归地对所有的属性进行拦截</strong>，重写 getter 函数和 setter 函数，而且只能对已经存在的属性进行劫持，<strong>监听不到属性的删除和新增</strong>。</p> <p>缺点：</p> <p>①对数组更新的时候无法实现响应式，它内部有一个this.$set去实现</p> <p>②如果响应式定义的数据层级比较深（对象里面还有对象），它内部是通过递归的形式去实现的；如果属性是在对象创建后动态添加的，那么这些属性将不是响应式的，除非显式地使用 Vue 提供的方法</p></li></ul> <blockquote><ul><li>还有很多情况是监听不到的，因为 defineProperty 只能劫持已有的属性，对于新增属性和删除属性是拦截不到的，必须额外通过 <strong>$set、 $delete</strong> 这些 API 来手动触发页面的更新，给开发者增加了负担。</li> <li>**Vue2 中，数组不采用 defineProperty 来进行劫持 （因为对所有索引进行劫持会造成性能浪费），需要对数组单独进行处理。**同时无法监控到数组的长度的变化，同样也是需要使用 $set 来处理。</li></ul></blockquote> <ul><li><p>Vue3底层是通过 ES6 的 Proxy 代理的方式重写了响应式系统，因为 proxy 可以<strong>对整个对象进行监听</strong>，所以不需要深度遍历。</p> <p>它解决了Vue2底层实现的缺点，对数组、层级比较深的对象处理都很优秀</p> <p>缺点：浏览器兼容不是很好</p></li></ul> <blockquote><ul><li>**它不需要对所有属性重写 getter 和 setter，还能监听到属性的删除和新增，**使用ref或者reactive将数据转化为响应式数据，能够更好地支持动态添加属性和删除属性。</li> <li><strong>可以直接监听数组的变化</strong>，在内部实现上进行了大量的优化，使得渲染速度更快，内存占用更少。包括ES6中的新增的 set 和 map 也支持了。</li></ul></blockquote> <p>以下是对两者响应式原理的详细对比：</p> <h3 id="vue2-的响应式原理"><a href="#vue2-的响应式原理" class="header-anchor">#</a> Vue2 的响应式原理</h3> <p>​	Vue2的响应式原理是基于<code>Object.defineProperty</code>方法实现的。这一方法允许对象中的属性被赋予getter和setter函数，从而实现对属性的访问和修改进行拦截。但这种方法有一些限制，比如不能监听数组的变化（除了<code>push</code>、<code>pop</code>等七个方法外），以及对象属性的添加或删除。</p> <p>​	在组件实例化过程中，Vue会对数据对象（data）<strong>进行递归地遍历</strong>，<strong>将每个属性都转换为getter/setter</strong>，并且为每个属性创建一个依赖追踪的系统。当属性被访问或修改时，getter/setter会触发依赖追踪系统，从而进行依赖收集和派发更新，以保证数据和视图的同步。</p> <blockquote><p>​	具体实现步骤如下：</p> <ol><li><p>创建Observer对象：通过递归地将data对象的属性转换为响应式属性，<strong>使用Object.defineProperty()为每个属性添加getter和setter方法</strong>。Vue2中 通过使用 Object.defineProperty() 方法，将对象的属性转换成 getter 和 setter，<strong>当数据发生变化时，会自动触发相应的更新函数，实现数据的响应式</strong>。</p> <ul><li><p>数据劫持：在Vue初始化时，Vue会遍历data中的所有属性，并使用<code>Object.defineProperty</code>将这些属性转化为getter和setter。由于vue2是针对属性的监听，所以就必须要去<strong>深度遍历</strong>每一个属性。</p></li> <li><p>Getter与Setter：</p> <p>Getter：在getter中，Vue会收集对数据的依赖。当一个属性被读取时，会触发getter，并把对应的依赖（Watcher）添加到依赖列表中。</p> <p>Setter：在setter中，Vue会监听到属性的变化。当一个属性被赋新值时，会触发setter，然后通知依赖列表中的Watcher执行更新。</p></li></ul></li> <li><p>创建Dep对象：用来管理 Watcher，它用来收集依赖、删除依赖和向依赖发送消息等。用于解耦属性的依赖收集和派发更新操作。</p></li> <li><p>创建Watcher对象：Watcher对象用于连接视图和数据之间的桥梁，<strong>当被依赖的属性发生变化时，Watcher对象会接收到通知并更新视图</strong>。当数据发生变化时，它会通知订阅该数据的组件更新视图。Watcher 在实例化时会将自己添加到 Dep 中，当数据发生变化时，会触发相应的更新函数。</p></li> <li><p>模板编译：Vue会解析模板，将模板中的数据绑定指令转译为对应的更新函数，以便在数据发生变化时调用。</p> <ul><li>Watcher这个机制用来收集依赖和触发更新。每个组件实例都会对应一个Watcher对象，用来管理该组件所依赖的属性。当组件中的数据被访问时，会触发对应的getter，并将该组件的Watcher添加到依赖列表中。</li> <li>在修改对象的值时，会触发对应的setter，setter通知之前依赖收集得到的依赖列表Dep中的所有Watcher，告诉它自己的值改变了，需要执行更新操作，重新渲染视图。这时，这些 Watcher就会开始调用update来更新视图，对应的getter触发追踪，把新值重新渲染到视图上。</li></ul></li></ol></blockquote> <p>​	限制：</p> <ul><li><p>Vue2的响应式系统仅对已经存在的属性进行劫持（且在created()之前就完成了监听），<strong>新添加的属性或删除的属性不会被响应式监听</strong>。</p> <ul><li>新增属性的响应问题：Vue.set 方法或 this.$set：向响应式对象中添加一个 property，并确保这个新 property 同样是响应式的，且触发视图更新。它必须用于向响应式对象上添加新 property，因为Vue 默认只能检测到那些在初始化时就已存在的属性的变化，无法探测普通的新增 property。</li> <li>对象属性的删除问题：①Vue.delete 方法或this.$delete：用来删除对象的属性，并触发响应式更新（很少用到）。eg：使用Vue.delete(vm.someObject, ‘propertyToDelete’)来删除一个属性。②正常的delete方法，虽然确实删除了属性，但是无法被监测到。</li></ul></li> <li><p><strong>对数组拦截有问题</strong>，对于数组的操作（如直接通过索引修改数组元素），无法直接进行响应式处理。如果通过数组下标修改对象属性的话是可以监测的，因为对象内部属性都是响应式的，但如果通过数组下标修改普通元素是无法监测到的。无法监控到数组的长度的变化。</p> <ul><li>使用数组变异方法：Vue提供了一些数组变异方法（push、pop、shift、unshift、splice、sort、reverse），这些方法主要集中在数组长度变化的操作，会触发数组的响应式更新（因为 Vue 在内部对这些方法进行了重写，以便在它们被调用时能够触发依赖的更新）。如果不是这7个方法的话（比如调用slice、map、filter等会返回一个新的数组，而不会修改原始数组），记得要将返回的新数组覆盖掉原始数组，依然能触发响应式。</li> <li>利用Vue.set方法：该方法不但能解决对象新增属性的问题，还能解决修改数组的问题（用的不多），但主要用于对象属性的添加或修改。</li> <li>替换整个数组：如果需要修改多个数组元素，并且想要确保这些修改都能被 Vue 检测到，可以考虑创建一个新数组，其中包含所有修改后的元素，然后用这个新数组替换原来的数组。</li></ul></li> <li><p>defineProperty方案<strong>在初始化时候</strong>，<strong>需要深度递归遍历待处理的对象才能对它进行完全拦截</strong>，明显增加了初始化的时间。</p></li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>	Object<span class="token punctuation">.</span>defineproperty 初始化的时候拦截对象，设置为<span class="token keyword">get</span>和<span class="token keyword">set</span>属性
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;wxs&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">监听到属性</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">改变</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'vivien'</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">;</span>
	输出结果 <span class="token operator">=&gt;</span> 监听到属性name需要改成vivien、监听到属性age需要改成<span class="token number">22</span>、监听不到属性sex
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="vue3-的响应式原理"><a href="#vue3-的响应式原理" class="header-anchor">#</a> Vue3 的响应式原理</h3> <p>​	Vue3的响应式原理相较于Vue2有了较大的改进，它基于ES6中的<code>Proxy</code>对象来实现响应式数据的双向绑定，Object.defineproperty是劫持所有对象的属性设置为getter、setter，然后遍历递归去实现，而proxy则是代理了整个对象，<strong>可以对整个对象进行监听，不需要深度遍历</strong>。</p> <p>​	优点：</p> <ul><li><strong>能对数组进行拦截，可以监听到数组索引和数组length属性，还能对Map，Set实现拦截</strong>，不再进行数组原型对象上重写数组方法</li> <li>proxy是懒处理行为，即<strong>只有在被访问或操作时才会触发相应的拦截器</strong>，也使之初始化速度和内存得到改善</li> <li>对象新增的属性不需要使用$set添加响应式，因为proxy<strong>默认会监听动态添加属性和删除属性等操作</strong>，vue2使用Object.defineproperty拦截对象的get和set属性进行操作，而proxy有着13种拦截方法（例如get/set属性、apply、construct、deleteProperty、getOwnPropertyDescriptor、getPrototypeOf、isExtensible、ownKeys、preventExtensions、setPrototype等），这些使得Proxy在处理对象属性时更加灵活和强大</li></ul> <p>​	缺陷：</p> <ul><li>Proxy API 并<strong>不能直接监听到内部深层次的对象变化</strong>：它拦截的是对代理对象的<strong>直接操作</strong>，如果对象内部有深层次的结构，比如嵌套的对象或数组，并且这些内部对象的变化是<strong>通过内部引用间接进行</strong>的，那么Proxy API无法直接捕获这些变化</li> <li>要监听内部深层次的对象变化，开发者需要手动<strong>递归地</strong>为每一层内部对象创建一个新的Proxy，并在陷阱函数（如<code>get</code>、<code>set</code>等）中实现相应的逻辑、</li> <li>存在兼容性问题，IE不支持</li></ul> <blockquote><p>​	原理：</p> <ol><li>Proxy对象：可以理解成在目标对象之前架设一层“拦截”，外界对该对象的访问都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写，Proxy对象允许我们在访问和修改对象属性时拦截并执行自定义的操作。（在Vue3中，使用<code>reactive</code>函数来创建一个响应式的数据对象。这个函数接收一个普通的JavaScript对象，并将其转化为Proxy对象）</li> <li>依赖收集和属性代理：
<ul><li>当我们访问响应式数据对象的属性时，Proxy对象会拦截这个操作，并建立一个依赖关系，将这个属性和正在访问它的地方关联起来</li> <li>当我们修改响应式数据对象的属性时，Proxy对象同样会拦截这个操作，并通知所有依赖于这个属性的地方进行更新</li></ul></li> <li>高效依赖追踪：Vue3使用了一个称为“依赖收集”的技术，可以更高效地进行依赖追踪。在访问响应式数据对象的属性时，Vue3会将正在访问这个属性的地方收集起来，并建立一个依赖关系图。当属性发生变化时，Vue3会根据这个依赖关系图，只更新那些真正依赖于这个属性的地方
<ul><li>由vue2的响应式原理可以看出，vue底层需要对vue实例的返回的每一个key进行get和set操作，无论这个值有没有被用到。所以在vue中定义的data属性越多，那么初始化开销就会越大。而proxy是一个惰性的操作，它只会在用到这个key的时候才会执行get，改值的时候才会执行set。所以在vue3中实现响应式的性能实际上要比vue2实现响应式性能要好</li></ul></li> <li>灵活性和深度追踪：Vue3的响应式系统更加灵活和高效。它能够在初始化时追踪到动态添加的属性，并且能够进行深层次的依赖追踪，而不仅限于对象的顶层属性</li></ol></blockquote> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>	proxy 初始化的时候，有使用这个key值则<span class="token keyword">get</span>一下，有设置这个key值则<span class="token keyword">set</span>一下
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'wxs'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token number">25</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> prxoyTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">监听到属性</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">需要改成</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
prxoyTarget<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'vivien'</span>
prxoyTarget<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">22</span>
prxoyTarget<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'female'</span>
	输出结果 <span class="token operator">=&gt;</span> 监听到属性name需要改成vivien、监听到属性age需要改成<span class="token number">22</span>、监听到属性sex需要改成female
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><p>vue2： 假如设置了obj:{a:1} ，若是给obj对象添加一个b属性值，直接在methods之中使用方法 obj.b = 2，导致的问题是：数据有更新，但是视图没有更新（ 需要使用this.$set()方法去设置b属性为响应式属性值，才能支持试图更新 ）【原因： object.defineProperty对于后期添加的属性值是不参与劫持设置为响应式属性的】</p></li> <li><p>vue3： 直接使用reactive定义对象，则当前对象为响应式对象，对于obj.b = 2 视图会更新！【原因：new Proxy对于后期添加的属性值是依旧走proxy内的set和get】</p></li></ul> <h1 id="二、核心实现"><a href="#二、核心实现" class="header-anchor">#</a> 二、核心实现</h1> <h2 id="虚拟-dom-渲染"><a href="#虚拟-dom-渲染" class="header-anchor">#</a> 虚拟 DOM 渲染</h2> <p>​	组件是一个抽象的概念，它是对一棵 DOM 树的抽象，组件的渲染取决于组件的模板。组件的模板决定了组件生成的 DOM 标签，而在 Vue 内部，一个组件想要真正的渲染生成 DOM，还需要经历 “创建 vnode - 渲染 vnode - 生成 DOM” 这几个步骤</p> <ol><li>应用程序初始化：创建 app 对象和重写 app.mount 方法</li></ol> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">createApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建 app 对象</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token operator">=</span> app
  <span class="token comment">// 重写 mount 方法</span>
  app<span class="token punctuation">.</span><span class="token function-variable function">mount</span> <span class="token operator">=</span> containerOrSelector <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>创建 vnode：<strong>组件 vnode 其实是对抽象事物的描述</strong>，将 DOM 使用 JavaScript 对象来描述，可以描述不同类型的节点，比如普通元素节点、组件节点等</li> <li>渲染 vnode：渲染组件生成 subTree、把 subTree 挂载到 container 中。通过 reder 函数创建组件树 vnode，把这个 vnode 再经过内部一层标准化，得到子树 vnode</li> <li>挂载元素函数：创建 DOM 元素节点、处理 props、处理 children、挂载 DOM 元素到 container 上</li></ol> <p><img src="/vivien-blog/assets/img/CgqCHl8EPLKAF8u5AAJHdNl56bM640.5bf438d5.png" alt="img"></p> <h2 id="diff-流程"><a href="#diff-流程" class="header-anchor">#</a> diff 流程</h2> <p>​	<strong>Diff 算法，在 Vue 里面就是叫做 <code>patch</code> ，它的核心参考Snabbdom，通过新旧虚拟 DOM 对比(即 patch 过程)，找出最小变化的地方转为进行 DOM 操作</strong>。在已知旧子节点的 DOM 结构、vnode 和新子节点的 vnode 情况下，以较低的成本完成子节点的更新为目的，求解生成新子节点 DOM 的系列操作。</p> <p><img src="data:image/jpeg;base64,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" alt="diff.jpg"></p> <ol><li>同步头部节点：就是从头部开始，依次对比新节点和旧节点，如果它们相同的则执行 patch 更新节点；如果不同或者索引 i 大于索引 e1 或者 e2，则同步过程结束。可以看到，完成头部节点同步后：i 是 2，e1 是 3，e2 是 4。</li></ol> <p><img src="/vivien-blog/assets/img/Ciqc1F8OxN6AMzbfAACPna55Fmk255.13391e61.png" alt="img"></p> <ol start="2"><li>同步尾部节点：就是从尾部开始，依次对比新节点和旧节点，如果相同的则执行 patch 更新节点；如果不同或者索引 i 大于索引 e1 或者 e2，则同步过程结束。可以看到，完成尾部节点同步后：i 是 2，e1 是 1，e2 是 2。</li></ol> <p><img src="/vivien-blog/assets/img/Ciqc1F8OxO2AffFhAACJ52ATnwQ480.71586f83.png" alt="img"></p> <p>​	接下来只有 3 种情况要处理：</p> <ul><li>新子节点有剩余要添加的新节点；</li> <li>旧子节点有剩余要删除的多余节点；</li> <li>未知子序列。</li></ul> <ol start="3"><li><p>添加新节点：首先要判断新子节点是否有剩余的情况，如果满足则添加新子节点。</p> <ul><li><p>如果索引 i 大于尾部索引 e1 且 i 小于 e2，那么从索引 i 开始到索引 e2 之间，我们直接挂载新子树这部分的节点。</p></li> <li><p>对我们的例子而言，同步完尾部节点后 i 是 2，e1 是 1，e2 是 2，此时满足条件需要添加新的节点。</p> <p><img src="/vivien-blog/assets/img/image-20240720165509914.b15dba4a.png" alt="image-20240720165509914"></p></li> <li><p>添加完 e 节点后，旧子节点的 DOM 和新子节点对应的 vnode 映射一致，也就完成了更新。</p></li></ul></li></ol> <p><img src="/vivien-blog/assets/img/CgqCHl8OxQKAd7fjAACNTHXEkuQ335.c910dca0.png" alt="img"></p> <ol start="4"><li>删除多余节点：如果不满足添加新节点的情况，我就要接着判断旧子节点是否有剩余，如果满足则删除旧子节点。</li></ol> <ul><li>从头部同步节点：</li></ul> <p><img src="/vivien-blog/assets/img/Ciqc1F8OxQ-ADmRcAACCSIpni8Y429.96ead88c.png" alt="img"></p> <ul><li>接着从尾部同步节点：
<ul><li>此时的结果：i 是 2，e1 是 2，e2 是 1，满足删除条件，因此删除子节点中的多余节点。</li></ul></li></ul> <p><img src="/vivien-blog/assets/img/Ciqc1F8OxRqANXzyAACGFb9dacI061.03f847f8.png" alt="img"></p> <ul><li>删除子节点中的多余节点：
<ul><li>删除完 c 节点后，旧子节点的 DOM 和新子节点对应的 vnode 映射一致，也就完成了更新。</li></ul></li></ul> <p><img src="/vivien-blog/assets/img/CgqCHl8OxSeAMW8gAACCvYcKESo055.8695a7d1.png" alt="img"></p> <ul><li>旧子节点的 DOM 和新子节点对应的 vnode 映射一致，也就完成了更新。</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2024/7/20 11:15:18</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vivien-blog/Vue/Vue3学习笔记/创建Vue3项目.html">
          创建Vue3项目
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-9f22dc18 data-v-222e0b9d><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#相关信息简介" class="sidebar-link reco-side-相关信息简介" data-v-9f22dc18>相关信息简介</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#性能提升" class="sidebar-link reco-side-性能提升" data-v-9f22dc18>性能提升</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#打包优化" class="sidebar-link reco-side-打包优化" data-v-9f22dc18>打包优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#treeshaking" class="sidebar-link reco-side-treeshaking" data-v-9f22dc18>TreeShaking</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#编译优化" class="sidebar-link reco-side-编译优化" data-v-9f22dc18>编译优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#静态节点的优化" class="sidebar-link reco-side-静态节点的优化" data-v-9f22dc18>静态节点的优化</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#静态提升" class="sidebar-link reco-side-静态提升" data-v-9f22dc18>静态提升</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#静态节点标记" class="sidebar-link reco-side-静态节点标记" data-v-9f22dc18>静态节点标记</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#ssr优化" class="sidebar-link reco-side-ssr优化" data-v-9f22dc18>SSR优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#动态节点的优化" class="sidebar-link reco-side-动态节点的优化" data-v-9f22dc18>动态节点的优化</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#动态追踪" class="sidebar-link reco-side-动态追踪" data-v-9f22dc18>动态追踪</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#动态节点标记" class="sidebar-link reco-side-动态节点标记" data-v-9f22dc18>动态节点标记</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#运行时优化" class="sidebar-link reco-side-运行时优化" data-v-9f22dc18>运行时优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#事件监听缓存优化" class="sidebar-link reco-side-事件监听缓存优化" data-v-9f22dc18>事件监听缓存优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#虚拟dom优化" class="sidebar-link reco-side-虚拟dom优化" data-v-9f22dc18>虚拟DOM优化</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#重写-diff-算法" class="sidebar-link reco-side-重写-diff-算法" data-v-9f22dc18>重写 diff 算法</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#源码层面" class="sidebar-link reco-side-源码层面" data-v-9f22dc18>源码层面</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#新增特性-组件" class="sidebar-link reco-side-新增特性-组件" data-v-9f22dc18>新增特性/组件</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#fragment-文档碎片-片段" class="sidebar-link reco-side-fragment-文档碎片-片段" data-v-9f22dc18>Fragment - 文档碎片（片段）</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#teleport-瞬移组件的位置-传送" class="sidebar-link reco-side-teleport-瞬移组件的位置-传送" data-v-9f22dc18>Teleport - 瞬移组件的位置（传送）</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#suspense-异步加载组件的-loading-界面-不确定的" class="sidebar-link reco-side-suspense-异步加载组件的-loading-界面-不确定的" data-v-9f22dc18>Suspense - 异步加载组件的 loading 界面（不确定的）</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#自定义渲染api" class="sidebar-link reco-side-自定义渲染api" data-v-9f22dc18>自定义渲染API</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#示例-重写createapp以支持自定义渲染" class="sidebar-link reco-side-示例-重写createapp以支持自定义渲染" data-v-9f22dc18>示例：重写createApp以支持自定义渲染</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#语法api不同" class="sidebar-link reco-side-语法api不同" data-v-9f22dc18>语法API不同</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#组件通信的区别" class="sidebar-link reco-side-组件通信的区别" data-v-9f22dc18>组件通信的区别</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#生命周期" class="sidebar-link reco-side-生命周期" data-v-9f22dc18>生命周期</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#vue2-x-的生命周期" class="sidebar-link reco-side-vue2-x-的生命周期" data-v-9f22dc18>vue2.x 的生命周期</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#vue3-0-的生命周期" class="sidebar-link reco-side-vue3-0-的生命周期" data-v-9f22dc18>vue3.0 的生命周期</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#响应式系统" class="sidebar-link reco-side-响应式系统" data-v-9f22dc18>响应式系统</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#数据劫持" class="sidebar-link reco-side-数据劫持" data-v-9f22dc18>数据劫持</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#vue2-的响应式原理" class="sidebar-link reco-side-vue2-的响应式原理" data-v-9f22dc18>Vue2 的响应式原理</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#vue3-的响应式原理" class="sidebar-link reco-side-vue3-的响应式原理" data-v-9f22dc18>Vue3 的响应式原理</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#虚拟-dom-渲染" class="sidebar-link reco-side-虚拟-dom-渲染" data-v-9f22dc18>虚拟 DOM 渲染</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Vue3%E4%B8%8EVue2%E5%AF%B9%E6%AF%94.html#diff-流程" class="sidebar-link reco-side-diff-流程" data-v-9f22dc18>diff 流程</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/vivien-blog/assets/js/app.06802b84.js" defer></script><script src="/vivien-blog/assets/js/7.ec60f3e8.js" defer></script><script src="/vivien-blog/assets/js/2.6744b811.js" defer></script><script src="/vivien-blog/assets/js/1.4a3363c7.js" defer></script><script src="/vivien-blog/assets/js/22.de88dfed.js" defer></script>
  </body>
</html>
