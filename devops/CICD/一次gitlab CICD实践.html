<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一次gitlab CICD实践 | Vivien&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/vivien-blog/logo.jpg">
    <meta name="description" content="Vivien个人博客">
    
    <link rel="preload" href="/vivien-blog/assets/css/0.styles.4edee94f.css" as="style"><link rel="preload" href="/vivien-blog/assets/js/app.1b7b4fd5.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/7.210383a7.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/2.00d63d32.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/1.96251043.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/59.89926beb.js" as="script"><link rel="prefetch" href="/vivien-blog/assets/js/10.fa80c4ef.js"><link rel="prefetch" href="/vivien-blog/assets/js/100.057c90a7.js"><link rel="prefetch" href="/vivien-blog/assets/js/101.19c4abac.js"><link rel="prefetch" href="/vivien-blog/assets/js/102.8bc66b45.js"><link rel="prefetch" href="/vivien-blog/assets/js/103.a3435343.js"><link rel="prefetch" href="/vivien-blog/assets/js/104.0068d84a.js"><link rel="prefetch" href="/vivien-blog/assets/js/105.04fc30e6.js"><link rel="prefetch" href="/vivien-blog/assets/js/106.9ff39244.js"><link rel="prefetch" href="/vivien-blog/assets/js/107.3b79619c.js"><link rel="prefetch" href="/vivien-blog/assets/js/108.d5bf9027.js"><link rel="prefetch" href="/vivien-blog/assets/js/109.698ce34c.js"><link rel="prefetch" href="/vivien-blog/assets/js/11.45f08108.js"><link rel="prefetch" href="/vivien-blog/assets/js/110.3681f055.js"><link rel="prefetch" href="/vivien-blog/assets/js/111.387f6115.js"><link rel="prefetch" href="/vivien-blog/assets/js/112.4d7580b7.js"><link rel="prefetch" href="/vivien-blog/assets/js/113.c3fe5fe0.js"><link rel="prefetch" href="/vivien-blog/assets/js/114.f0df6d73.js"><link rel="prefetch" href="/vivien-blog/assets/js/115.2388eeb0.js"><link rel="prefetch" href="/vivien-blog/assets/js/116.94a902d0.js"><link rel="prefetch" href="/vivien-blog/assets/js/117.35c6f7e1.js"><link rel="prefetch" href="/vivien-blog/assets/js/118.f7ecaac7.js"><link rel="prefetch" href="/vivien-blog/assets/js/119.53eceb0f.js"><link rel="prefetch" href="/vivien-blog/assets/js/120.1bbfbebb.js"><link rel="prefetch" href="/vivien-blog/assets/js/121.b66bb0a4.js"><link rel="prefetch" href="/vivien-blog/assets/js/122.1a72171a.js"><link rel="prefetch" href="/vivien-blog/assets/js/123.49317ff6.js"><link rel="prefetch" href="/vivien-blog/assets/js/124.1919ad13.js"><link rel="prefetch" href="/vivien-blog/assets/js/125.46542121.js"><link rel="prefetch" href="/vivien-blog/assets/js/126.d20b2438.js"><link rel="prefetch" href="/vivien-blog/assets/js/127.096c8422.js"><link rel="prefetch" href="/vivien-blog/assets/js/128.6f10ade2.js"><link rel="prefetch" href="/vivien-blog/assets/js/129.be3e0f7e.js"><link rel="prefetch" href="/vivien-blog/assets/js/130.92794b90.js"><link rel="prefetch" href="/vivien-blog/assets/js/131.93cec235.js"><link rel="prefetch" href="/vivien-blog/assets/js/14.41118c66.js"><link rel="prefetch" href="/vivien-blog/assets/js/15.3131a535.js"><link rel="prefetch" href="/vivien-blog/assets/js/16.0fcf1058.js"><link rel="prefetch" href="/vivien-blog/assets/js/17.c4515dab.js"><link rel="prefetch" href="/vivien-blog/assets/js/18.2fe122be.js"><link rel="prefetch" href="/vivien-blog/assets/js/19.341cf97a.js"><link rel="prefetch" href="/vivien-blog/assets/js/20.c523984f.js"><link rel="prefetch" href="/vivien-blog/assets/js/21.06b93e75.js"><link rel="prefetch" href="/vivien-blog/assets/js/22.9f594ab7.js"><link rel="prefetch" href="/vivien-blog/assets/js/23.409fd3e4.js"><link rel="prefetch" href="/vivien-blog/assets/js/24.5a3a4049.js"><link rel="prefetch" href="/vivien-blog/assets/js/25.21fac10f.js"><link rel="prefetch" href="/vivien-blog/assets/js/26.c590614b.js"><link rel="prefetch" href="/vivien-blog/assets/js/27.b8c03943.js"><link rel="prefetch" href="/vivien-blog/assets/js/28.2c65a62c.js"><link rel="prefetch" href="/vivien-blog/assets/js/29.15a38861.js"><link rel="prefetch" href="/vivien-blog/assets/js/3.934f6b75.js"><link rel="prefetch" href="/vivien-blog/assets/js/30.8704b94b.js"><link rel="prefetch" href="/vivien-blog/assets/js/31.e6e61ee0.js"><link rel="prefetch" href="/vivien-blog/assets/js/32.c193bc49.js"><link rel="prefetch" href="/vivien-blog/assets/js/33.03974196.js"><link rel="prefetch" href="/vivien-blog/assets/js/34.7e51c94f.js"><link rel="prefetch" href="/vivien-blog/assets/js/35.1da6c0eb.js"><link rel="prefetch" href="/vivien-blog/assets/js/36.44155ea4.js"><link rel="prefetch" href="/vivien-blog/assets/js/37.c892cb88.js"><link rel="prefetch" href="/vivien-blog/assets/js/38.20dcb46a.js"><link rel="prefetch" href="/vivien-blog/assets/js/39.ab72969e.js"><link rel="prefetch" href="/vivien-blog/assets/js/4.35261d9d.js"><link rel="prefetch" href="/vivien-blog/assets/js/40.d1f877b5.js"><link rel="prefetch" href="/vivien-blog/assets/js/41.58cf6028.js"><link rel="prefetch" href="/vivien-blog/assets/js/42.1056cd44.js"><link rel="prefetch" href="/vivien-blog/assets/js/43.d32266a5.js"><link rel="prefetch" href="/vivien-blog/assets/js/44.652b8114.js"><link rel="prefetch" href="/vivien-blog/assets/js/45.1deb9d35.js"><link rel="prefetch" href="/vivien-blog/assets/js/46.1b0a642d.js"><link rel="prefetch" href="/vivien-blog/assets/js/47.f74917b1.js"><link rel="prefetch" href="/vivien-blog/assets/js/48.b394b7e1.js"><link rel="prefetch" href="/vivien-blog/assets/js/49.b1d92ead.js"><link rel="prefetch" href="/vivien-blog/assets/js/5.fa969ab7.js"><link rel="prefetch" href="/vivien-blog/assets/js/50.3676a039.js"><link rel="prefetch" href="/vivien-blog/assets/js/51.8625a796.js"><link rel="prefetch" href="/vivien-blog/assets/js/52.85e6ae67.js"><link rel="prefetch" href="/vivien-blog/assets/js/53.cf3b4106.js"><link rel="prefetch" href="/vivien-blog/assets/js/54.195eccac.js"><link rel="prefetch" href="/vivien-blog/assets/js/55.a23fa0b5.js"><link rel="prefetch" href="/vivien-blog/assets/js/56.cc54345c.js"><link rel="prefetch" href="/vivien-blog/assets/js/57.3074601a.js"><link rel="prefetch" href="/vivien-blog/assets/js/58.5861d737.js"><link rel="prefetch" href="/vivien-blog/assets/js/6.28daaf49.js"><link rel="prefetch" href="/vivien-blog/assets/js/60.7333cd13.js"><link rel="prefetch" href="/vivien-blog/assets/js/61.c0ec386a.js"><link rel="prefetch" href="/vivien-blog/assets/js/62.47dd6986.js"><link rel="prefetch" href="/vivien-blog/assets/js/63.7a8aca22.js"><link rel="prefetch" href="/vivien-blog/assets/js/64.45edd43b.js"><link rel="prefetch" href="/vivien-blog/assets/js/65.7b6e7073.js"><link rel="prefetch" href="/vivien-blog/assets/js/66.f8cbb551.js"><link rel="prefetch" href="/vivien-blog/assets/js/67.6cc4496a.js"><link rel="prefetch" href="/vivien-blog/assets/js/68.91f8578c.js"><link rel="prefetch" href="/vivien-blog/assets/js/69.2a8f1cef.js"><link rel="prefetch" href="/vivien-blog/assets/js/70.7a4f08f0.js"><link rel="prefetch" href="/vivien-blog/assets/js/71.072edcd7.js"><link rel="prefetch" href="/vivien-blog/assets/js/72.11e37d34.js"><link rel="prefetch" href="/vivien-blog/assets/js/73.b2ed6145.js"><link rel="prefetch" href="/vivien-blog/assets/js/74.b0ffe6f1.js"><link rel="prefetch" href="/vivien-blog/assets/js/75.37f798b5.js"><link rel="prefetch" href="/vivien-blog/assets/js/76.4a2f8418.js"><link rel="prefetch" href="/vivien-blog/assets/js/77.26d75a07.js"><link rel="prefetch" href="/vivien-blog/assets/js/78.de800dca.js"><link rel="prefetch" href="/vivien-blog/assets/js/79.6ac0d041.js"><link rel="prefetch" href="/vivien-blog/assets/js/8.cbde96fb.js"><link rel="prefetch" href="/vivien-blog/assets/js/80.96d5beb2.js"><link rel="prefetch" href="/vivien-blog/assets/js/81.4d9e115c.js"><link rel="prefetch" href="/vivien-blog/assets/js/82.948fa90e.js"><link rel="prefetch" href="/vivien-blog/assets/js/83.246d9e36.js"><link rel="prefetch" href="/vivien-blog/assets/js/84.79d82321.js"><link rel="prefetch" href="/vivien-blog/assets/js/85.d881655a.js"><link rel="prefetch" href="/vivien-blog/assets/js/86.0d3c4c1c.js"><link rel="prefetch" href="/vivien-blog/assets/js/87.241b57a2.js"><link rel="prefetch" href="/vivien-blog/assets/js/88.4cb09072.js"><link rel="prefetch" href="/vivien-blog/assets/js/89.6b6a6d21.js"><link rel="prefetch" href="/vivien-blog/assets/js/9.09f385e1.js"><link rel="prefetch" href="/vivien-blog/assets/js/90.684c40fa.js"><link rel="prefetch" href="/vivien-blog/assets/js/91.3abfbc85.js"><link rel="prefetch" href="/vivien-blog/assets/js/92.8e112cc6.js"><link rel="prefetch" href="/vivien-blog/assets/js/93.ccd72f8f.js"><link rel="prefetch" href="/vivien-blog/assets/js/94.50ca9f79.js"><link rel="prefetch" href="/vivien-blog/assets/js/95.bfe29f10.js"><link rel="prefetch" href="/vivien-blog/assets/js/96.a5f404ee.js"><link rel="prefetch" href="/vivien-blog/assets/js/97.c86f128e.js"><link rel="prefetch" href="/vivien-blog/assets/js/98.59512bfd.js"><link rel="prefetch" href="/vivien-blog/assets/js/99.cf1ceb98.js"><link rel="prefetch" href="/vivien-blog/assets/js/vendors~docsearch.36c01082.js">
    <link rel="stylesheet" href="/vivien-blog/assets/css/0.styles.4edee94f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-222e0b9d><div data-v-222e0b9d><div class="password-shadow password-wrapper-out" style="display:none;" data-v-15719524 data-v-222e0b9d data-v-222e0b9d><h3 class="title" data-v-15719524>Vivien's Notebook</h3> <p class="description" data-v-15719524>Vivien个人博客</p> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div class="hide" data-v-222e0b9d><header class="navbar" data-v-222e0b9d><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vivien-blog/" class="home-link router-link-active"><img src="/vivien-blog/logo.jpg" alt="Vivien's Notebook" class="logo"> <span class="site-name">Vivien's Notebook</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-222e0b9d></div> <aside class="sidebar" data-v-222e0b9d><div class="personal-info-wrapper" data-v-2710484f data-v-222e0b9d><img src="/vivien-blog/avator.jpg" alt="author-avatar" class="personal-img" data-v-2710484f> <!----> <div class="num" data-v-2710484f><div data-v-2710484f><h3 data-v-2710484f>92</h3> <h6 data-v-2710484f>文章</h6></div> <div data-v-2710484f><h3 data-v-2710484f>11</h3> <h6 data-v-2710484f>标签</h6></div></div> <ul class="social-links" data-v-2710484f><li class="social-item" data-v-2710484f><i class="iconfont reco-github" style="color:#f47e60;" data-v-2710484f></i></li></ul> <hr data-v-2710484f></div> <nav class="nav-links"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码规范</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/devops/代码规范/概述.html" class="sidebar-link">概述</a></li><li><a href="/vivien-blog/devops/代码规范/项目风格统一[.editorconfig].html" class="sidebar-link">项目风格统一[.editorconfig]</a></li><li><a href="/vivien-blog/devops/代码规范/CSS格式规范[.stylelintrc].html" class="sidebar-link">CSS格式规范[.stylelintrc]</a></li><li><a href="/vivien-blog/devops/代码规范/JS代码规范[.eslintrc+.prettierrc].html" class="sidebar-link">JS代码规范[.eslintrc+.prettierrc]</a></li><li><a href="/vivien-blog/devops/代码规范/Git提交信息规范[commitlint+cz-git].html" class="sidebar-link">Git提交信息规范[commitlint+cz-git]</a></li><li><a href="/vivien-blog/devops/代码规范/Git工作流规范[husky+lint-staged].html" class="sidebar-link">Git工作流规范[husky+lint-staged]</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/devops/webpack/webpack执行流程.html" class="sidebar-link">webpack执行流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CICD</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/devops/CICD/半自动化部署.html" class="sidebar-link">半自动化部署</a></li><li><a href="/vivien-blog/devops/CICD/gitlabCICD.html" class="sidebar-link">gitlab CICD</a></li><li><a href="/vivien-blog/devops/CICD/一次gitlab CICD实践.html" class="active sidebar-link">一次gitlab CICD实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构&amp;方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/devops/渲染架构/前端渲染模式.html" class="sidebar-link">前端渲染模式</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-15719524 data-v-222e0b9d><h3 class="title" data-v-15719524>一次gitlab CICD实践</h3> <!----> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div data-v-222e0b9d><div data-v-222e0b9d><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">一次gitlab CICD实践</h1> <div data-v-f31d237c><i class="iconfont reco-account" data-v-f31d237c><span data-v-f31d237c>vivien</span></i> <i class="iconfont reco-date" data-v-f31d237c><span data-v-f31d237c>2024/8/7</span></i> <i class="iconfont reco-eye" data-v-f31d237c><span id="/vivien-blog/devops/CICD/%E4%B8%80%E6%AC%A1gitlab%20CICD%E5%AE%9E%E8%B7%B5.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f31d237c><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-f31d237c><span class="tag-item" data-v-f31d237c>Devops</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>​	有一个 monorepo 微前端项目，需要一次构建3个项目，放在根目录下的packages文件夹下，分别是rdm、rdm-old、rdm-new，在测试分支打包，分别生成自己的 dist/test，正式服则是 dist/prod，正式服构建到 A 服务器的 rdm、rdm-old、rdm-new 文件夹，测试服到 B 服务器的 rdm、rdm-old、rdm-new 文件夹。现在，我们希望在一次CI/CD流程中构建并部署多个子应用（rdm, rdm-new, rdm-old），同时这些应用需要被部署到不同服务器上的不同的 FTP 目录。</p> <p><img src="/vivien-blog/assets/img/image-20240807185820028.ceaba977.png" alt="image-20240807185820028"><img src="data:image/png;base64,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" alt="image-20240807185923912"></p> <p>​	用直观的方式呈现如下图：</p> <p><img src="/vivien-blog/assets/img/image-20240807192830095.43d9f68c.png" alt="image-20240807192830095"></p> <h2 id="方案"><a href="#方案" class="header-anchor">#</a> 方案</h2> <p>​	为了实现这个需求，我们可以在<code>.gitlab-ci.yml</code>文件中设置一个共同的构建阶段，然后针对不同的环境（测试服和正式服）和不同的子应用设置不同的部署阶段。</p> <p><img src="/vivien-blog/assets/img/ahfkdwbl6y.47397815.png" alt="img"></p> <h2 id="配置-gitlab-ci-yml"><a href="#配置-gitlab-ci-yml" class="header-anchor">#</a> 配置 gitlab-ci.yml</h2> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 定义CI/CD的阶段 </span>
<span class="token key atrule">stages</span><span class="token punctuation">:</span>  
  <span class="token punctuation">-</span> build   <span class="token comment"># 构建阶段 </span>
  <span class="token punctuation">-</span> deploy  <span class="token comment"># 部署阶段  </span>
  
<span class="token comment"># 定义一些全局变量，用于SSH连接和部署  </span>
<span class="token key atrule">variables</span><span class="token punctuation">:</span>  
  <span class="token key atrule">SSH_USER</span><span class="token punctuation">:</span> <span class="token string">&quot;用户名&quot;</span>  
  <span class="token key atrule">SSH_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">&quot;用户密码&quot;</span>  
  <span class="token key atrule">SSH_OPTIONS</span><span class="token punctuation">:</span> <span class="token string">&quot;-o StrictHostKeyChecking=no&quot;</span>  
  
<span class="token comment"># 定义一个模板，用于SSH部署  </span>
<span class="token key atrule">.deploy_template</span><span class="token punctuation">:</span> <span class="token important">&amp;deploy_template</span>  
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy  
  <span class="token key atrule">script</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> echo &quot;Deploying to $TARGET_SERVER in $DEPLOY_PATH&quot;  
    <span class="token punctuation">-</span> sshpass <span class="token punctuation">-</span>p &quot;$SSH_PASSWORD&quot; ssh $SSH_USER@$TARGET_SERVER &quot;mkdir <span class="token punctuation">-</span>p $DEPLOY_PATH&quot;  
    <span class="token punctuation">-</span> sshpass <span class="token punctuation">-</span>p &quot;$SSH_PASSWORD&quot; scp <span class="token punctuation">-</span>r $SSH_OPTIONS ./dist/$DEPLOY_TYPE/* $SSH_USER@$TARGET_SERVER<span class="token punctuation">:</span>$DEPLOY_PATH  
  
<span class="token comment"># RDM 构建和部署  </span>
<span class="token key atrule">rdm-build</span><span class="token punctuation">:</span>  
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  
  <span class="token key atrule">script</span><span class="token punctuation">:</span>   <span class="token comment"># 构建脚本</span>
    <span class="token punctuation">-</span> cd packages/rdm  
    <span class="token punctuation">-</span> pnpm install  
    <span class="token punctuation">-</span> pnpm run build<span class="token punctuation">:</span>$CI_COMMIT_REF_NAME  <span class="token comment"># 假设你有一个脚本来根据分支构建到不同的目录  </span>
    <span class="token punctuation">-</span> <span class="token punctuation">|</span>  <span class="token comment"># 使用管道符来在单行中写多条命令,如果是主分支,将dist目录重命名为dist/prod    </span>
      if <span class="token punctuation">[</span> &quot;$CI_COMMIT_REF_NAME&quot; == &quot;main&quot; <span class="token punctuation">]</span>; then  
        mv dist dist/prod   
      else  
        mv dist dist/test  
      fi  
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>  <span class="token comment"># 指定要保留的构建产物 </span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>  
      <span class="token punctuation">-</span> packages/rdm/dist/prod/  <span class="token comment"># 如果需要包含主分支的产出  </span>
      <span class="token punctuation">-</span> packages/rdm/dist/test/  <span class="token comment"># 如果需要包含非主分支的产出  </span>
  
<span class="token key atrule">rdm-deploy-prod</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  <span class="token comment"># 覆盖模板中的变量 </span>
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;正式服-服务器 A 地址&quot;</span>  
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm&quot;</span>   <span class="token comment"># 部署路径  </span>
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;prod&quot;</span>   <span class="token comment"># 部署类型</span>
  <span class="token key atrule">only</span><span class="token punctuation">:</span>   <span class="token comment"># 仅当提交到prod分支时运行</span>
    <span class="token punctuation">-</span> prod  
  
<span class="token key atrule">rdm-deploy-test</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;测试服-服务器 B 地址&quot;</span>   
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm&quot;</span>  
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span>  
  <span class="token key atrule">except</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> main  


 

<span class="token comment"># RDM-OLD  </span>
<span class="token key atrule">rdm-old-build</span><span class="token punctuation">:</span>  
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  
  <span class="token key atrule">script</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> cd packages/rdm<span class="token punctuation">-</span>old  
    <span class="token punctuation">-</span> pnpm install  
    <span class="token punctuation">-</span> pnpm run build<span class="token punctuation">:</span>$CI_COMMIT_REF_NAME  <span class="token comment"># 假设你有一个脚本来根据分支构建到不同的目录  </span>
    <span class="token punctuation">-</span> <span class="token punctuation">|</span>  <span class="token comment"># 使用管道符来在单行中写多条命令  </span>
      if <span class="token punctuation">[</span> &quot;$CI_COMMIT_REF_NAME&quot; == &quot;main&quot; <span class="token punctuation">]</span>; then  
        mv dist dist/prod  
      else  
        mv dist dist/test  
      fi  
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>  
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>  
      <span class="token punctuation">-</span> packages/rdm<span class="token punctuation">-</span>old/dist/prod/  <span class="token comment"># 如果需要包含主分支的产出  </span>
      <span class="token punctuation">-</span> packages/rdm<span class="token punctuation">-</span>old/dist/test/  <span class="token comment"># 如果需要包含非主分支的产出  </span>
  
<span class="token key atrule">rdm-old-deploy-prod</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;正式服-服务器 A 地址&quot;</span>  
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm-old&quot;</span>  
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;prod&quot;</span>  
  <span class="token key atrule">only</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> prod  
  
<span class="token key atrule">rdm-old-deploy-test</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;测试服-服务器 B 地址&quot;</span>  
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm-old&quot;</span>  
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span>  
  <span class="token key atrule">except</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> main  
  



<span class="token comment"># RDM-NEW  </span>
<span class="token key atrule">rdm-new-build</span><span class="token punctuation">:</span>  
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build  
  <span class="token key atrule">script</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> cd packages/rdm<span class="token punctuation">-</span>new  
    <span class="token punctuation">-</span> pnpm install  
    <span class="token punctuation">-</span> pnpm run build<span class="token punctuation">:</span>$CI_COMMIT_REF_NAME  <span class="token comment"># 假设这个脚本会根据分支名称构建到不同的目录，但实际上它不会改变dist的目录名  </span>
    <span class="token punctuation">-</span> <span class="token punctuation">|</span>  <span class="token comment"># 使用管道符来在单行中写多条命令  </span>
      if <span class="token punctuation">[</span> &quot;$CI_COMMIT_REF_NAME&quot; == &quot;main&quot; <span class="token punctuation">]</span>; then  
        mv dist dist/prod  
      else  
        mv dist dist/test  
      fi  
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>  
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>  
      <span class="token punctuation">-</span> packages/rdm<span class="token punctuation">-</span>new/dist/prod/  <span class="token comment"># 如果需要包含主分支的产出  </span>
      <span class="token punctuation">-</span> packages/rdm<span class="token punctuation">-</span>new/dist/test/  <span class="token comment"># 如果需要包含非主分支的产出  </span>
  
<span class="token key atrule">rdm-new-deploy-prod</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;正式服-服务器 A 地址&quot;</span> 
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm-new&quot;</span>  
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;prod&quot;</span>  
  <span class="token key atrule">only</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> prod 
  
<span class="token key atrule">rdm-new-deploy-test</span><span class="token punctuation">:</span>  
  <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*deploy_template</span>  
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>  
    <span class="token key atrule">TARGET_SERVER</span><span class="token punctuation">:</span> <span class="token string">&quot;测试服-服务器 B 地址&quot;</span>  
    <span class="token key atrule">DEPLOY_PATH</span><span class="token punctuation">:</span> <span class="token string">&quot;/rdm-new&quot;</span>  
    <span class="token key atrule">DEPLOY_TYPE</span><span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span>  
  <span class="token key atrule">except</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> main  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2024/8/16 02:59:12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/vivien-blog/devops/CICD/gitlabCICD.html" class="prev">
          gitlab CICD
        </a></span> <span class="next"><a href="/vivien-blog/devops/渲染架构/前端渲染模式.html">
          前端渲染模式
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-9f22dc18 data-v-222e0b9d><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/devops/CICD/%E4%B8%80%E6%AC%A1gitlab%20CICD%E5%AE%9E%E8%B7%B5.html#背景" class="sidebar-link reco-side-背景" data-v-9f22dc18>背景</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/devops/CICD/%E4%B8%80%E6%AC%A1gitlab%20CICD%E5%AE%9E%E8%B7%B5.html#方案" class="sidebar-link reco-side-方案" data-v-9f22dc18>方案</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/devops/CICD/%E4%B8%80%E6%AC%A1gitlab%20CICD%E5%AE%9E%E8%B7%B5.html#配置-gitlab-ci-yml" class="sidebar-link reco-side-配置-gitlab-ci-yml" data-v-9f22dc18>配置 gitlab-ci.yml</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/vivien-blog/assets/js/app.1b7b4fd5.js" defer></script><script src="/vivien-blog/assets/js/7.210383a7.js" defer></script><script src="/vivien-blog/assets/js/2.00d63d32.js" defer></script><script src="/vivien-blog/assets/js/1.96251043.js" defer></script><script src="/vivien-blog/assets/js/59.89926beb.js" defer></script>
  </body>
</html>
