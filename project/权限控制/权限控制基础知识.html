<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>权限控制基础知识 | Vivien&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/vivien-blog/logo.jpg">
    <script src="/vivien-blog/watermark.js"></script>
    <meta name="description" content="Vivien个人博客">
    
    <link rel="preload" href="/vivien-blog/assets/css/0.styles.4edee94f.css" as="style"><link rel="preload" href="/vivien-blog/assets/js/app.49640b82.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/7.ec60f3e8.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/2.6744b811.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/1.4a3363c7.js" as="script"><link rel="preload" href="/vivien-blog/assets/js/29.050194a5.js" as="script"><link rel="prefetch" href="/vivien-blog/assets/js/10.4c4f923d.js"><link rel="prefetch" href="/vivien-blog/assets/js/100.23f6ee21.js"><link rel="prefetch" href="/vivien-blog/assets/js/101.3e53df80.js"><link rel="prefetch" href="/vivien-blog/assets/js/102.795f5f16.js"><link rel="prefetch" href="/vivien-blog/assets/js/103.fead0127.js"><link rel="prefetch" href="/vivien-blog/assets/js/104.9f0fb22f.js"><link rel="prefetch" href="/vivien-blog/assets/js/105.4fa50f5b.js"><link rel="prefetch" href="/vivien-blog/assets/js/106.601985f8.js"><link rel="prefetch" href="/vivien-blog/assets/js/107.9ba60431.js"><link rel="prefetch" href="/vivien-blog/assets/js/108.8b7cf753.js"><link rel="prefetch" href="/vivien-blog/assets/js/109.363d2316.js"><link rel="prefetch" href="/vivien-blog/assets/js/11.c96b7ce6.js"><link rel="prefetch" href="/vivien-blog/assets/js/110.cac5d5ac.js"><link rel="prefetch" href="/vivien-blog/assets/js/111.2c304996.js"><link rel="prefetch" href="/vivien-blog/assets/js/112.175b1533.js"><link rel="prefetch" href="/vivien-blog/assets/js/113.f7a94348.js"><link rel="prefetch" href="/vivien-blog/assets/js/114.2919ddce.js"><link rel="prefetch" href="/vivien-blog/assets/js/115.9492e6b7.js"><link rel="prefetch" href="/vivien-blog/assets/js/116.b10ed1ff.js"><link rel="prefetch" href="/vivien-blog/assets/js/117.d5a69554.js"><link rel="prefetch" href="/vivien-blog/assets/js/118.a0631e74.js"><link rel="prefetch" href="/vivien-blog/assets/js/119.e61066ef.js"><link rel="prefetch" href="/vivien-blog/assets/js/120.95523cfb.js"><link rel="prefetch" href="/vivien-blog/assets/js/121.7279e08a.js"><link rel="prefetch" href="/vivien-blog/assets/js/122.1946f5d1.js"><link rel="prefetch" href="/vivien-blog/assets/js/123.1d46e7f2.js"><link rel="prefetch" href="/vivien-blog/assets/js/124.f6fa825b.js"><link rel="prefetch" href="/vivien-blog/assets/js/125.37c6ef1d.js"><link rel="prefetch" href="/vivien-blog/assets/js/126.2840024e.js"><link rel="prefetch" href="/vivien-blog/assets/js/127.5b2b66d3.js"><link rel="prefetch" href="/vivien-blog/assets/js/128.d11fb749.js"><link rel="prefetch" href="/vivien-blog/assets/js/129.9b05740c.js"><link rel="prefetch" href="/vivien-blog/assets/js/130.19afd51d.js"><link rel="prefetch" href="/vivien-blog/assets/js/131.c39fe5fc.js"><link rel="prefetch" href="/vivien-blog/assets/js/132.166206d3.js"><link rel="prefetch" href="/vivien-blog/assets/js/14.dac78458.js"><link rel="prefetch" href="/vivien-blog/assets/js/15.30ff7af8.js"><link rel="prefetch" href="/vivien-blog/assets/js/16.f5bca61b.js"><link rel="prefetch" href="/vivien-blog/assets/js/17.7fea8ba1.js"><link rel="prefetch" href="/vivien-blog/assets/js/18.8a66241c.js"><link rel="prefetch" href="/vivien-blog/assets/js/19.1723465f.js"><link rel="prefetch" href="/vivien-blog/assets/js/20.b9adffab.js"><link rel="prefetch" href="/vivien-blog/assets/js/21.80e1ddc6.js"><link rel="prefetch" href="/vivien-blog/assets/js/22.de88dfed.js"><link rel="prefetch" href="/vivien-blog/assets/js/23.f2b02a6d.js"><link rel="prefetch" href="/vivien-blog/assets/js/24.08096abb.js"><link rel="prefetch" href="/vivien-blog/assets/js/25.8aed4354.js"><link rel="prefetch" href="/vivien-blog/assets/js/26.bf9dc0fe.js"><link rel="prefetch" href="/vivien-blog/assets/js/27.0dbf3088.js"><link rel="prefetch" href="/vivien-blog/assets/js/28.c9f5f184.js"><link rel="prefetch" href="/vivien-blog/assets/js/3.7a6d346e.js"><link rel="prefetch" href="/vivien-blog/assets/js/30.bff23b52.js"><link rel="prefetch" href="/vivien-blog/assets/js/31.a10b30c7.js"><link rel="prefetch" href="/vivien-blog/assets/js/32.4c227bf7.js"><link rel="prefetch" href="/vivien-blog/assets/js/33.9873b2e4.js"><link rel="prefetch" href="/vivien-blog/assets/js/34.661b84b0.js"><link rel="prefetch" href="/vivien-blog/assets/js/35.e6dccfdc.js"><link rel="prefetch" href="/vivien-blog/assets/js/36.98205037.js"><link rel="prefetch" href="/vivien-blog/assets/js/37.44516ca8.js"><link rel="prefetch" href="/vivien-blog/assets/js/38.dc9c4a51.js"><link rel="prefetch" href="/vivien-blog/assets/js/39.be23166d.js"><link rel="prefetch" href="/vivien-blog/assets/js/4.6d6477a3.js"><link rel="prefetch" href="/vivien-blog/assets/js/40.e5f670f0.js"><link rel="prefetch" href="/vivien-blog/assets/js/41.236d900a.js"><link rel="prefetch" href="/vivien-blog/assets/js/42.67482f69.js"><link rel="prefetch" href="/vivien-blog/assets/js/43.1de2024a.js"><link rel="prefetch" href="/vivien-blog/assets/js/44.7ddd9470.js"><link rel="prefetch" href="/vivien-blog/assets/js/45.31587bf5.js"><link rel="prefetch" href="/vivien-blog/assets/js/46.8616ff54.js"><link rel="prefetch" href="/vivien-blog/assets/js/47.d3d247b3.js"><link rel="prefetch" href="/vivien-blog/assets/js/48.927b0f38.js"><link rel="prefetch" href="/vivien-blog/assets/js/49.7c185fdb.js"><link rel="prefetch" href="/vivien-blog/assets/js/5.8f70aa2d.js"><link rel="prefetch" href="/vivien-blog/assets/js/50.e8d25d24.js"><link rel="prefetch" href="/vivien-blog/assets/js/51.e8251262.js"><link rel="prefetch" href="/vivien-blog/assets/js/52.fbef7aa0.js"><link rel="prefetch" href="/vivien-blog/assets/js/53.2b707def.js"><link rel="prefetch" href="/vivien-blog/assets/js/54.b5188815.js"><link rel="prefetch" href="/vivien-blog/assets/js/55.8b80c528.js"><link rel="prefetch" href="/vivien-blog/assets/js/56.bf368327.js"><link rel="prefetch" href="/vivien-blog/assets/js/57.ddbebf8b.js"><link rel="prefetch" href="/vivien-blog/assets/js/58.b10e0d1a.js"><link rel="prefetch" href="/vivien-blog/assets/js/59.a4b90e38.js"><link rel="prefetch" href="/vivien-blog/assets/js/6.892ce6e5.js"><link rel="prefetch" href="/vivien-blog/assets/js/60.b8bfb276.js"><link rel="prefetch" href="/vivien-blog/assets/js/61.843f60af.js"><link rel="prefetch" href="/vivien-blog/assets/js/62.51cffd1c.js"><link rel="prefetch" href="/vivien-blog/assets/js/63.5f954f00.js"><link rel="prefetch" href="/vivien-blog/assets/js/64.0ce5fe98.js"><link rel="prefetch" href="/vivien-blog/assets/js/65.a86fd28b.js"><link rel="prefetch" href="/vivien-blog/assets/js/66.8e9ea32a.js"><link rel="prefetch" href="/vivien-blog/assets/js/67.18095c46.js"><link rel="prefetch" href="/vivien-blog/assets/js/68.f74a0870.js"><link rel="prefetch" href="/vivien-blog/assets/js/69.4e844f29.js"><link rel="prefetch" href="/vivien-blog/assets/js/70.41013b20.js"><link rel="prefetch" href="/vivien-blog/assets/js/71.26e44e39.js"><link rel="prefetch" href="/vivien-blog/assets/js/72.30c0279f.js"><link rel="prefetch" href="/vivien-blog/assets/js/73.38c20cb3.js"><link rel="prefetch" href="/vivien-blog/assets/js/74.6dafa03f.js"><link rel="prefetch" href="/vivien-blog/assets/js/75.6608de22.js"><link rel="prefetch" href="/vivien-blog/assets/js/76.5e19e581.js"><link rel="prefetch" href="/vivien-blog/assets/js/77.1abbb1df.js"><link rel="prefetch" href="/vivien-blog/assets/js/78.c1d36b7b.js"><link rel="prefetch" href="/vivien-blog/assets/js/79.ff61e0ac.js"><link rel="prefetch" href="/vivien-blog/assets/js/8.b0ba342b.js"><link rel="prefetch" href="/vivien-blog/assets/js/80.dfa3f211.js"><link rel="prefetch" href="/vivien-blog/assets/js/81.285bac2c.js"><link rel="prefetch" href="/vivien-blog/assets/js/82.f50cbf20.js"><link rel="prefetch" href="/vivien-blog/assets/js/83.6440b662.js"><link rel="prefetch" href="/vivien-blog/assets/js/84.bfd378d6.js"><link rel="prefetch" href="/vivien-blog/assets/js/85.b9ac818d.js"><link rel="prefetch" href="/vivien-blog/assets/js/86.2ee8cc6a.js"><link rel="prefetch" href="/vivien-blog/assets/js/87.56fa5a36.js"><link rel="prefetch" href="/vivien-blog/assets/js/88.c64fa37a.js"><link rel="prefetch" href="/vivien-blog/assets/js/89.12e1a1e4.js"><link rel="prefetch" href="/vivien-blog/assets/js/9.524cff04.js"><link rel="prefetch" href="/vivien-blog/assets/js/90.e5cb233a.js"><link rel="prefetch" href="/vivien-blog/assets/js/91.15feaa5b.js"><link rel="prefetch" href="/vivien-blog/assets/js/92.44aad763.js"><link rel="prefetch" href="/vivien-blog/assets/js/93.45a553ea.js"><link rel="prefetch" href="/vivien-blog/assets/js/94.74a76eb1.js"><link rel="prefetch" href="/vivien-blog/assets/js/95.6314d68a.js"><link rel="prefetch" href="/vivien-blog/assets/js/96.0def9066.js"><link rel="prefetch" href="/vivien-blog/assets/js/97.1010a1a2.js"><link rel="prefetch" href="/vivien-blog/assets/js/98.5dd57b30.js"><link rel="prefetch" href="/vivien-blog/assets/js/99.b01b0c86.js"><link rel="prefetch" href="/vivien-blog/assets/js/vendors~docsearch.da1394aa.js">
    <link rel="stylesheet" href="/vivien-blog/assets/css/0.styles.4edee94f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-222e0b9d><div data-v-222e0b9d><div class="password-shadow password-wrapper-out" style="display:none;" data-v-15719524 data-v-222e0b9d data-v-222e0b9d><h3 class="title" data-v-15719524>Vivien's Notebook</h3> <p class="description" data-v-15719524>Vivien个人博客</p> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div class="hide" data-v-222e0b9d><header class="navbar" data-v-222e0b9d><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vivien-blog/" class="home-link router-link-active"><img src="/vivien-blog/logo.jpg" alt="Vivien's Notebook" class="logo"> <span class="site-name">Vivien's Notebook</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-222e0b9d></div> <aside class="sidebar" data-v-222e0b9d><div class="personal-info-wrapper" data-v-2710484f data-v-222e0b9d><img src="/vivien-blog/avator.jpg" alt="author-avatar" class="personal-img" data-v-2710484f> <!----> <div class="num" data-v-2710484f><div data-v-2710484f><h3 data-v-2710484f>92</h3> <h6 data-v-2710484f>文章</h6></div> <div data-v-2710484f><h3 data-v-2710484f>11</h3> <h6 data-v-2710484f>标签</h6></div></div> <ul class="social-links" data-v-2710484f><li class="social-item" data-v-2710484f><i class="iconfont reco-github" style="color:#f47e60;" data-v-2710484f></i></li></ul> <hr data-v-2710484f></div> <nav class="nav-links"><div class="nav-item"><a href="/vivien-blog/base/browser/输入URL到页面展示发生了什么/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></div><div class="nav-item"><a href="/vivien-blog/Vue/Vue3学习笔记/Vue3与Vue2对比/" class="nav-link"><i class="undefined"></i>
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端基础知识/" class="nav-link"><i class="undefined"></i>
  微前端基础知识
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/微前端解决方案/" class="nav-link"><i class="undefined"></i>
  微前端解决方案
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/MicroFrontends/使用MicroApp重构旧项目/" class="nav-link"><i class="undefined"></i>
  使用MicroApp重构旧项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      前端工程化
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/代码规范/概述/" class="nav-link"><i class="undefined"></i>
  代码规范
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/webpack/webpack执行流程/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/CICD/半自动化部署/" class="nav-link"><i class="undefined"></i>
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/devops/渲染架构/前端渲染模式/" class="nav-link"><i class="undefined"></i>
  架构&amp;方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      书籍
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/books/深入浅出webpack/为什么要使用webpack/" class="nav-link"><i class="undefined"></i>
  深入浅出webpack
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/ES6入门教程/ES6与JavaScript/" class="nav-link"><i class="undefined"></i>
  ES6入门教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/TypeScript教程/简介和基本用法/" class="nav-link"><i class="undefined"></i>
  TypeScript教程
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/books/Vue.js设计与实现/1.权衡的艺术/" class="nav-link"><i class="undefined"></i>
  Vue.js设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      项目实践
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vivien-blog/project/权限控制/权限控制基础知识/" class="nav-link"><i class="undefined"></i>
  权限控制
</a></li><li class="dropdown-item"><!----> <a href="/vivien-blog/project/项目搭建/搭建一个组件库/" class="nav-link"><i class="undefined"></i>
  项目搭建
</a></li></ul></div></div><div class="nav-item"><a href="/vivien-blog/React/React基础知识/" class="nav-link"><i class="undefined"></i>
  React
</a></div><div class="nav-item"><a href="/vivien-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/vivien-blog/messageBoard/messageBoard.html" class="nav-link"><i class="iconfont reco-message"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      contact Vivien
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yoguoer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Vivien_CC" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>权限控制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/project/权限控制/权限控制基础知识.html" class="active sidebar-link">权限控制基础知识</a></li><li><a href="/vivien-blog/project/权限控制/系统权限控制插件.html" class="sidebar-link">系统权限控制插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目搭建</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vivien-blog/project/项目搭建/搭建一个组件库.html" class="sidebar-link">搭建一个组件库</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-15719524 data-v-222e0b9d><h3 class="title" data-v-15719524>权限控制基础知识</h3> <!----> <label id="box" class="inputBox" data-v-15719524><input type="password" value="" data-v-15719524> <span data-v-15719524>Konck! Knock!</span> <button data-v-15719524>OK</button></label> <div class="footer" data-v-15719524><span data-v-15719524><i class="iconfont reco-theme" data-v-15719524></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-15719524>vuePress-theme-reco</a></span> <span data-v-15719524><i class="iconfont reco-copyright" data-v-15719524></i> <a data-v-15719524><!---->
          
        <!---->
        2025
      </a></span></div></div> <div data-v-222e0b9d><div data-v-222e0b9d><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">权限控制基础知识</h1> <div data-v-f31d237c><i class="iconfont reco-account" data-v-f31d237c><span data-v-f31d237c>vivien</span></i> <i class="iconfont reco-date" data-v-f31d237c><span data-v-f31d237c>2024/4/22</span></i> <i class="iconfont reco-eye" data-v-f31d237c><span id="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f31d237c><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-f31d237c><span class="tag-item" data-v-f31d237c>Permission</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="rbac模型"><a href="#rbac模型" class="header-anchor">#</a> RBAC模型</h2> <p>​	RBAC(Role-BasedAccess Control)，是基于角色的访问控制，是一种安全策略，它通过在用户和权限之间引入角色概念，来实现对资源的访问控制。<strong>在RBAC中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。</strong></p> <p><img src="/vivien-blog/assets/img/permission-1.5a7141e3.png" alt="img"></p> <h3 id="rbac支持的安全原则"><a href="#rbac支持的安全原则" class="header-anchor">#</a> RBAC支持的安全原则</h3> <ul><li><strong>最小权限原则(即细粒度控制原则)</strong>：RBAC可将其角色配置成其完成任务所需要的最小权限集</li> <li><strong>责任分离原则</strong>：通过调用相互独立互斥的角色来共同完成敏感的任务而体现，如要求一个计帐员和财务管理员一起参与同一个过帐</li> <li><strong>数据抽象原则</strong>：通过权限的抽象来体现，如财务操作用借款、存款等抽象权限</li></ul> <h3 id="rbac的基本数据元素"><a href="#rbac的基本数据元素" class="header-anchor">#</a> RBAC的基本数据元素</h3> <ul><li><strong>用户 users</strong>：主体，即需要访问系统资源的个体或实体。每个用户都有一个或多个与之关联的角色。用户的身份通过身份验证过程进行确认，以确保其合法性。</li> <li><strong>角色 roles</strong>：核心概念，它代表了一组权限的集合。角色通常根据业务功能或职责进行定义，例如“管理员”、“编辑员”、“访客”等。通过将角色分配给用户，可以实现用户与权限的间接关联，从而简化权限管理。</li> <li><strong>目标 objects</strong>：资源或资产，即用户需要访问的实体。目标可以是文件、数据库、设备、服务或任何系统管理的其他资源。每个目标都有与之关联的操作和许可权。</li> <li><strong>操作 operations</strong>：对目标进行的特定行为或动作，例如读取、写入、执行、删除等。每个目标都可以定义一组允许的操作，这些操作定义了用户对目标可以执行的行为。</li> <li><strong>许可权 permissions</strong>：基本权限单位，它定义了用户对特定目标执行特定操作的授权。许可权通常由角色来赋予，即角色具有一组许可权，用户通过继承角色的许可权来获得对目标和操作的访问权限。</li></ul> <p>​	管理员首先定义角色并为其分配相应的许可权，然后将角色分配给用户。这样，用户就通过其关联的角色获得了对目标和操作的访问权限。当需要调整用户的权限时，管理员只需修改用户的角色分配，而无需逐个修改用户的许可权，从而大大简化了权限管理过程。</p> <blockquote><p>​	<strong>RBAC中对于权限控制的做法</strong>：</p> <p>角色是为了完成各种工作而创造，用户则依据责任和资格来被指派相应的角色，用户可以很容易地从一个角色被指派到另一个角色。</p> <p>角色可依新的需求和系统的合并而赋予新的权限，而权限也可根据需要而从某角色中回收。</p> <p>角色与角色的关系同样也存在继承关系防止越权，角色与角色的关系可以建立起来以囊括更广泛的客观情况。</p></blockquote> <h3 id="rbac设计思想"><a href="#rbac设计思想" class="header-anchor">#</a> RBAC设计思想</h3> <h4 id="基本模型rbac0"><a href="#基本模型rbac0" class="header-anchor">#</a> 基本模型<strong>RBAC0</strong></h4> <p>​	RBAC0定义了能构成RBAC控制系统的最小的元素集合。</p> <p>​	用户和角色、角色和权限多对多关系。</p> <p>​	就是一个用户拥有多个角色，一个角色可以被多个用户拥有，这是用户和角色的多对多关系；同样的，角色和权限也是如此。</p> <p><img src="/vivien-blog/assets/img/permission-2.fdb5d9a4.jpg" alt="img"></p> <h4 id="角色分层模型rbac1"><a href="#角色分层模型rbac1" class="header-anchor">#</a> <strong>角色分层模型RBAC1</strong></h4> <p>​	RBAC1建立在RBAC0基础之上，在角色中引入了继承的概念，有了继承那么角色就有了上下级或者等级关系。类似于树形结构，子角色可以继承父角色的所有权限。</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <blockquote><p>如果采用RBAC0模型做权限系统，我可能需要为经理、主管、专员分别创建一个角色（角色之间权限无继承性），极有可能出现一个问题，由于权限配置错误，主管拥有经理都没有权限。</p> <p>RBAC1解决了这个问题，创建完经理角色并配置好权限后，主管角色的权限继承经理角色的权限，并且支持针对性删减主管权限。</p></blockquote> <h4 id="角色限制模型rbac2"><a href="#角色限制模型rbac2" class="header-anchor">#</a> 角色限制模型<strong>RBAC2</strong></h4> <p>​	RBAC2在RBAC0基础上加入了约束的概念，主要引入了静态职责分离SSD和动态职责分离DSD。主要是为了增加角色赋予的限制条件，这也符合权限系统的目标：权责明确，系统使用安全、保密。</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <blockquote><ol><li><p>角色互斥：同一用户不能分配到一组互斥角色集合中的多个角色，互斥角色是指权限互相制约的两个角色。</p> <p>案例：财务系统中一个用户不能同时被指派给会计角色和审计员角色。</p></li> <li><p>基数约束：一个角色被分配的用户数量受限，它指的是有多少用户能拥有这个角色。</p> <p>例如：一个角色专门为公司CEO创建的，那这个角色的数量是有限的。</p> <p>先决条件角色：指要想获得较高的权限，要首先拥有低一级的权限。</p> <p>例如：先有副总经理权限，才能有总经理权限。</p></li> <li><p>运行时互斥：例如，允许一个用户具有两个角色的成员资格，但在运行中不可同时激活这两个角色。</p></li></ol></blockquote> <h4 id="统一模型rbac3"><a href="#统一模型rbac3" class="header-anchor">#</a> 统一模型<strong>RBAC3</strong></h4> <p>​	是RBAC1与RBAC2的合集，所以RBAC3是既有角色分层又有约束的一种模型。这种模式既要维护好角色间的继承关系处理好分层，又要处理角色间的责任分离。</p> <p>​	以上就是RBAC模型的四种设计思想，现在我们用的权限模型都是在RBAC模型的基础上根据自己的业务进行组合和改进。</p> <h2 id="rbac-权限管理的在实际系统中的应用"><a href="#rbac-权限管理的在实际系统中的应用" class="header-anchor">#</a> <strong>RBAC 权限管理的在实际系统中的应用</strong></h2> <p>​	RBAC 权限模型由三大部分构成，即<strong>用户管理</strong>、<strong>角色管理</strong>、<strong>权限管理</strong>。</p> <ul><li>用户管理按照企业架构或业务线架构来划分，这些结构本身比较清晰，扩展性和可读性都非常好。</li> <li>角色管理一定要在深入理解业务逻辑后再来设计，一般使用各部门真实的角色作为基础，再根据业务逻辑进行扩展。</li> <li>权限管理是前两种管理的再加固，做太细容易太碎片，做太粗又不够安全，这里我们需要根据经验和实际情况来设计。</li></ul> <h2 id="vben的三种权限处理方式"><a href="#vben的三种权限处理方式" class="header-anchor">#</a> Vben的三种权限处理方式：</h2> <ol><li>通过用户角色来过滤菜单(前端方式控制)，菜单和路由分开配置</li> <li>通过用户角色来过滤菜单(前端方式控制)，菜单由路由配置自动生成</li> <li>通过后台来动态生成路由表(后台方式控制)</li></ol> <h3 id="前端角色权限"><a href="#前端角色权限" class="header-anchor">#</a> 前端角色权限</h3> <p>​	<strong>原理：</strong> 在前端写死路由的权限，指定路由有哪些权限可以查看。</p> <ol><li>只初始化通用路由，带权限路由没有被加入路由表内。</li> <li>在登陆后或其他方式获取用户角色后，通过角色去遍历路由表，获取该角色可以访问的路由表，生成路由表。</li> <li>再通过 <code>router.addRoutes</code> 添加到路由实例，实现权限的过滤。</li></ol> <p>​	<strong>缺点：</strong> 权限相对不自由，如果后台改动角色，前台也要跟着改动。适合角色较固定的系统</p> <p>动态更换角色</p> <p>细粒度权限：函数方式、组件方式、指令方式</p> <h3 id="后台动态获取"><a href="#后台动态获取" class="header-anchor">#</a> 后台动态获取</h3> <p>​	<strong>原理：</strong> 通过接口动态生成路由表，且遵循一定的数据结构返回。前端根据需要处理该数据为可识别的结构，再通过 <code>router.addRoutes</code> 添加到路由实例，实现权限的动态生成。</p> <p>动态更换菜单：函数方式、组件方式、指令方式</p> <p>细粒度权限</p> <h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h2> <p>​	<code>vue-router</code> 提供的导航守卫主要用来通过跳转或取消的方式守卫导航。<code>vue-router</code> 提供了导航钩子：全局前置导航钩子 <code>beforeEach</code> 和全局后置导航钩子 <code>afterEach</code>，它们会在路由即将改变前和改变后进行触发。和 <code>beforeEach</code> 不同的是 <code>afterEach</code> 不接收第三个参数 <code>next</code> 函数，也不会改变导航本身。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 必须调用 `next` */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">beforeResolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 必须调用 `next` */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>导航钩子有3个参数：</strong></p> <ol><li>to：即将要进入的目标路由对象</li> <li>from：当前导航即将要离开的路由对象</li> <li>next ：调用该方法后，才能进入下一个钩子函数（afterEach）</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 只有next()是放行，但是如果next()里有参数的话，next()就像被重载一样，就有了不同的功能，实际上是中断当前导航，执行新的导航。</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//直接进to 所指路由</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//中断当前路由</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'route'</span><span class="token punctuation">)</span> <span class="token comment">//跳转指定路由</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token comment">//跳转错误路由</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="router-addroute"><a href="#router-addroute" class="header-anchor">#</a> router.addRoute()</h3> <p>​	<code>router.addRoute</code> 可以动态添加一条新路由。若该路由有 name，并且已经存在一个与之相同的名字，则会覆盖它。</p> <ul><li>添加一个新的路由记录。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">addRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>添加一个新的路由记录，将其作为一个已有路由的子路由。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">addRoute</span><span class="token punctuation">(</span>parentName<span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="router-beforeeach"><a href="#router-beforeeach" class="header-anchor">#</a> router.beforeEach</h3> <p>​	全局前置守卫，初始化的时候被调用、每次路由切换之前被调用。A路由向B路由跳转时 只要形成路由跳转，在切换之前进行调用。</p> <ul><li>添加一个导航钩子，它会在每次导航之前被执行。返回一个用来移除该钩子的函数。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">beforeEach</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>举个例子：判断token否存在以及要进入的页面。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span>from<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> localstorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token operator">==</span><span class="token string">'/login'</span> <span class="token operator">||</span> token<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 如果token存在或者要进入的页面是登陆页，放行</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 如果没有token并且进入的页面不是登陆页，那么提示过期并跳转到login页面</span>
    vm<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'登录过期，请重新登陆'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/login'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="router-aftereach"><a href="#router-aftereach" class="header-anchor">#</a> router.afterEach</h3> <p>​	全局后置钩子，初始化的时候被调用、每次路由切换之后被调用。</p> <ul><li>添加一个导航钩子，它会在每次导航之后被执行。返回一个用来移除该钩子的函数。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">afterEach</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>举个例子：每次切换页面时，页面的title也会跟着修改，同时，让页面滚动到最顶部。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span>from<span class="token punctuation">,</span>nex</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 document<span class="token punctuation">.</span>title <span class="token operator">=</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title
 window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="beforeresolve"><a href="#beforeresolve" class="header-anchor">#</a> beforeResolve</h3> <p>​	全局解析守卫，在每次导航时都会触发，不同的是，它会在导航被确认之前、所有组件内守卫和异步路由组件被解析之后调用。</p> <ul><li>添加一个导航守卫，它会在导航将要被解析之前被执行。此时所有组件都已经获取完毕，且其它导航守卫也都已经完成调用。返回一个用来移除该守卫的函数。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">beforeResolve</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="beforeenter"><a href="#beforeenter" class="header-anchor">#</a> beforeEnter</h3> <p>​	路由独享守卫，某一个路由所单独享用的，只有前置没有后置。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/users/:id'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> UserDetails<span class="token punctuation">,</span>
    <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//只在进入路由时触发，不会在 params、query 或 hash 改变时触发</span>
      <span class="token comment">// reject the navigation</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="beforerouteenter"><a href="#beforerouteenter" class="header-anchor">#</a> <strong>beforeRouteEnter</strong></h3> <p>​	组件路由守卫，通过路由规则，进入该组件时被调用。</p> <h3 id="beforerouteleave"><a href="#beforerouteleave" class="header-anchor">#</a> <strong>beforeRouteLeave</strong></h3> <p>​	组件路由守卫，通过路由规则，离开该组件时被调用(不能说是后置，因为进入之后并不会触发，而是离开这个组件之前会触发)。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> UserDetails <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在渲染该组件的对应路由被验证前调用</span>
    <span class="token comment">// 不能获取组件实例 `this` ！</span>
    <span class="token comment">// 因为当守卫执行时，组件实例还没被创建！</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteUpdate</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在当前路由改变，但是该组件被复用时调用</span>
    <span class="token comment">// 举例来说，对于一个带有动态参数的路径 `/users/:id`，在 `/users/1` 和 `/users/2` 之间跳转的时候，</span>
    <span class="token comment">// 由于会渲染同样的 `UserDetails` 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span>
    <span class="token comment">// 因为在这种情况发生的时候，组件已经挂载好了，导航守卫可以访问组件实例 `this`</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在导航离开渲染该组件的对应路由时调用</span>
    <span class="token comment">// 与 `beforeRouteUpdate` 一样，它可以访问组件实例 `this`</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h2> <p>​	权限管理一般从三个方面来做限制。<strong>页面/菜单权限</strong>，<strong>操作权限</strong>，<strong>数据权限</strong>。</p> <p><img src="/vivien-blog/assets/img/permission-5.9cd6ddc7.jpg" alt="img"></p> <h3 id="页面-菜单权限"><a href="#页面-菜单权限" class="header-anchor">#</a> <strong>页面/菜单权限</strong></h3> <p>​	对于没有权限操作的用户，直接隐藏对应的页面入口或菜单选项。这种方法简单快捷直接，对于一些安全不太敏感的权限，使用这种方式非常高效。</p> <ul><li><strong>页面级权限控制</strong>：页面权限中通过后台配置中的标识返回字符串 和前端路由中name字段进行匹配</li></ul> <h3 id="组件-按钮级权限"><a href="#组件-按钮级权限" class="header-anchor">#</a> <strong>组件/按钮级权限</strong></h3> <ul><li><p><strong>按钮级权限</strong>：根据用户的权限不同，对不同的按钮进行权限控制，对同一组数据，不同的用户是否可以增删改查。对某些用户来说是只读浏览数据，对某些用户来说是可编辑的数据。除了按钮，比如页面中的某个字段，某个div，某个组件要求根据当前用户的权限进行控制时，都可以称为按钮级权限。</p></li> <li><p><strong>组件级权限控制</strong>：组件级权限分为与项目信息相关的权限和与个人/部门/职位 相关的权限</p></li></ul> <h3 id="与用户信息挂钩-数据权限"><a href="#与用户信息挂钩-数据权限" class="header-anchor">#</a> <strong>与用户信息挂钩/数据权限</strong></h3> <p>​	对于安全需求高的权限管理，仅从前端限制隐藏菜单/编辑按钮是不够的，还需要在数接口上做限制。如果用户试图通过非法手段编辑不属于自己权限下的数据，服务器端会识别、记录并限制访问。<strong>操作按钮显示=数据状态+当前用户角色组合，列表每一行数据操作按钮的显示跟当前行数据状态和当前用户角色关联</strong>。</p> <ul><li><strong>跟用户信息挂钩的数据</strong>，需要服务端返回单独字段控制。可结合数据状态和用户角色来确定前端操作按钮的显示，从而实现精细化的权限控制。</li></ul> <blockquote><p><strong>数据权限如何管控?</strong></p> <p>数据权限可以分为行权限和列权限。行权限控制：看多少条数据。列权限控制：看一条数据的多少个字段</p> <p>可以通过组织架构来管控行权限，按照角色来配置列权限，但是遇到复杂情况，组织架构是承载不了复杂行权限管控，角色也更不能承载列的特殊化展示。</p> <p>目前行业的做法是提供行列级数据权规则配置，把规则当成类似权限点配置赋予某个角色或者某个用户。</p></blockquote> <h2 id="权限管理实现思路"><a href="#权限管理实现思路" class="header-anchor">#</a> 权限管理实现思路</h2> <h3 id="页面-菜单权限-2"><a href="#页面-菜单权限-2" class="header-anchor">#</a> 页面/菜单权限</h3> <ol><li>后端权限管理配置
<ul><li><strong>后台系统维护侧边栏目录的配置</strong>，包括目录名称、图标、链接等。</li> <li>后端接口能够返回侧边栏的树形结构数据，<strong>这些数据应该包含每个菜单项对应的路由地址和权限标识。</strong></li></ul></li> <li>前端路由配置
<ul><li><strong>前端项目中定义好静态路由和动态路由的配置。</strong></li> <li>静态路由通常是那些不需要权限即可访问的页面，如登录页、404页面等。动态路由则是根据用户角色和权限来动态生成的路由。</li></ul></li> <li>路由匹配与生成
<ul><li>调用后端接口获取侧边栏树形结构数据。前端通过递归遍历后端返回的树形结构数据，并与前端配置的路由进行匹配。</li> <li><strong>对于匹配成功的路由，将其加入到异步路由表中。</strong></li></ul></li> <li>路由表整合
<ul><li><strong>将动态生成的异步路由表和静态的常规路由表进行整合。</strong></li> <li>确保整合后的路由表是完整的，并且按照正确的顺序排列。</li></ul></li> <li>生成侧边栏菜单
<ul><li>根据整合后的路由表，<strong>生成侧边栏菜单的DOM结构。</strong></li> <li>侧边栏菜单应该包含所有用户有权限访问的菜单项。对于没有权限访问的菜单项，应该进行隐藏或者显示为不可点击状态。</li></ul></li> <li>路由守卫与权限校验
<ul><li><strong>在前端实现路由守卫，对用户的访问进行权限校验。</strong></li> <li>当用户尝试访问某个页面时，检查该用户是否具有访问该页面的权限。如果没有权限，则重定向到无权限页面或提示用户。</li></ul></li> <li>缓存与性能优化
<ul><li>对于一些不经常变动的侧边栏数据，可以考虑使用缓存来提高性能。</li> <li>在用户登录成功后，可以将侧边栏数据缓存起来，避免重复请求后端接口。</li></ul></li></ol> <blockquote><p>​	下面是一个示例：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 假设后端返回的数据结构如下：  </span>
<span class="token keyword">const</span> menuData <span class="token operator">=</span> <span class="token punctuation">[</span>  
  <span class="token punctuation">{</span>  
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'首页'</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token string">'view_home'</span><span class="token punctuation">,</span>  
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
      <span class="token comment">// 子菜单项...  </span>
    <span class="token punctuation">]</span>  
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  
  <span class="token comment">// 其他菜单项...  </span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 前端配置的静态路由  </span>
<span class="token keyword">const</span> staticRoutes <span class="token operator">=</span> <span class="token punctuation">[</span>  
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Login <span class="token punctuation">}</span><span class="token punctuation">,</span>  
  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/404'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> NotFound <span class="token punctuation">}</span><span class="token punctuation">,</span>  
  <span class="token comment">// 其他静态路由...  </span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 动态生成异步路由  </span>
<span class="token keyword">function</span> <span class="token function">generateAsyncRoutes</span><span class="token punctuation">(</span><span class="token parameter">menuData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> asyncRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
  menuData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      item<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">generateAsyncRoutes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归生成子路由  </span>
    <span class="token punctuation">}</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">userHasPermission</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 假设userHasPermission函数用来检查用户权限  </span>
      asyncRoutes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
        <span class="token literal-property property">path</span><span class="token operator">:</span> item<span class="token punctuation">.</span>path<span class="token punctuation">,</span>  
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/views</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.vue</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 动态导入组件  </span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">permission</span><span class="token operator">:</span> item<span class="token punctuation">.</span>permission <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 可以将权限信息存储在meta中  </span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> item<span class="token punctuation">.</span>children<span class="token punctuation">,</span>  
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> asyncRoutes<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// 整合路由表  </span>
<span class="token keyword">const</span> allRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>staticRoutes<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">generateAsyncRoutes</span><span class="token punctuation">(</span>menuData<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 根据路由表生成侧边栏菜单（这里省略具体实现，根据路由表渲染DOM即可）  </span>
<span class="token function">generateSidebarMenu</span><span class="token punctuation">(</span>allRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 路由守卫示例（在Vue Router中使用beforeEach）  </span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment">// 检查用户是否拥有该路由的权限  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">userHasPermission</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/no-permission'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无权限则重定向  </span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有权限则继续  </span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不需要权限的路由直接通过  </span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div></blockquote> <h3 id="组件-按钮级权限-2"><a href="#组件-按钮级权限-2" class="header-anchor">#</a> 组件/按钮级权限</h3> <ol><li>用户登录与权限获取
<ul><li><strong>用户登录成功后，后端应返回包含用户权限信息的响应。</strong></li> <li>权限信息可以是一个包含多个权限字段的集合，每个字段代表一个特定的权限。</li></ul></li> <li>前端存储权限信息
<ul><li><strong>前端接收到权限信息后，应将其存储在本地</strong>，如使用浏览器的localStorage或sessionStorage。</li> <li>也可以将权限信息保存在Vuex（如果使用的是Vue框架）或其他状态管理库中，以便在组件中方便地访问。</li></ul></li> <li>自定义指令 v-permission
<ul><li><strong>创建一个自定义指令 <code>v-permission</code>，用于在DOM元素上添加权限控制逻辑。</strong></li> <li>当元素绑定该指令时，它会检查当前用户是否具有相应的权限。如果没有权限，则隐藏或禁用该元素。</li></ul></li> <li>自定义方法 this.hasPermission
<ul><li>在Vue组件或全局方法中，<strong>定义一个 <code>hasPermission</code> 方法，用于在JavaScript代码中判断权限。</strong></li> <li>这个方法接受一个权限字段作为参数，并返回用户是否拥有该权限的布尔值。</li></ul></li> <li>视图权限判断
<ul><li>在模板中，使用 <code>v-permission</code> 指令来判断是否显示按钮或组件。</li> <li>例如：<code>&lt;button v-permission=&quot;'edit-item'&quot;&gt;编辑&lt;/button&gt;</code>。这里的 <code>'edit-item'</code> 是一个权限字段。</li></ul></li> <li>逻辑权限判断
<ul><li>在组件的方法或计算属性中，使用 <code>this.hasPermission</code> 方法来判断是否执行某些逻辑。</li> <li>例如：<code>if (this.hasPermission('delete-item')) { /* 执行删除逻辑 */ }</code>。</li></ul></li> <li>动态组件与路由权限
<ul><li>对于动态加载的组件，可以在加载前检查权限，避免无权限用户访问。</li> <li>对于路由权限，可以结合Vue Router的导航守卫（navigation guards）来实现。在路由跳转前，检查用户是否拥有访问目标路由的权限。</li></ul></li></ol> <blockquote><p>​	下面是一个示例：</p> <p>​	首先，假设后端在用户登录成功后返回的响应中包含了一个权限字段集合，如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>  
  <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user123&quot;</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;view_dashboard&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit_item&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete_item&quot;</span><span class="token punctuation">]</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​	前端Vue组件中，我们可以创建一个自定义指令 <code>v-permission</code> 和一个全局方法 <code>hasPermission</code>。自定义指令 <code>v-permission</code> 的实现：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  
  <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">const</span> permission <span class="token operator">=</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vnode<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或者可以设置为隐藏：el.style.display = 'none';  </span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  
  <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment">// 当权限变化时，重新判断  </span>
    <span class="token keyword">const</span> permission <span class="token operator">=</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">;</span>  
    <span class="token keyword">const</span> hasPermission <span class="token operator">=</span> vnode<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasPermission<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 显示元素  </span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span> <span class="token comment">// 隐藏元素  </span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>​	全局方法 <code>hasPermission</code> 的实现：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hasPermission</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">permission</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token comment">// 假设我们在Vuex中存储了用户的权限信息  </span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">;</span>  
  <span class="token keyword">const</span> userPermissions <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>permissions<span class="token punctuation">;</span>  
  <span class="token keyword">return</span> userPermissions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	现在，我们可以在Vue组件的模板中使用这个自定义指令来控制按钮的显示：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>edit_item'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>delete_item'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  
    <span class="token comment">&lt;!-- 其他组件或按钮 --&gt;</span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>  
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  
  <span class="token comment">// ... 其他选项 ...  </span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
    <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token string">'some_special_permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token comment">// 执行特殊权限的操作  </span>
      <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在这个例子中，<code>v-permission</code> 指令被绑定到按钮上，并传入了一个权限字符串（如 <code>'edit_item'</code>）。当Vue实例被创建或更新时，指令的 <code>inserted</code> 和 <code>update</code> 钩子函数会被调用，它们会根据用户的权限来决定是否显示按钮。</p> <p><code>hasPermission</code> 方法用于在Vue组件的逻辑中判断用户是否拥有某个权限。在组件的方法或计算属性中，我们可以调用这个方法来决定是否执行某些操作。</p></blockquote> <h3 id="与用户信息挂钩-数据权限-2"><a href="#与用户信息挂钩-数据权限-2" class="header-anchor">#</a> 与用户信息挂钩/数据权限</h3> <ol><li><p>数据状态与用户角色关联</p> <ul><li>每行数据都有一个状态字段，而每个用户都有一个角色。操作按钮的显示取决于这两个因素。</li></ul></li> <li><p>服务端返回数据</p> <ul><li>服务端返回的数据包括每行数据的状态、与这行数据相关的用户ID（如leaderId, creatorId），以及当前用户的ID。</li></ul></li> <li><p>维护Map表</p> <ul><li><p><code>statusButtonsMap</code>：维护数据状态与操作按钮的映射关系。</p></li> <li><p><code>userButtonsMap</code>：维护用户角色与操作按钮的映射关系。</p></li></ul></li> <li><p>获取行数据状态操作</p> <ul><li>根据服务端返回的行数据状态和<code>statusButtonsMap</code>，确定该行数据状态对应的操作按钮集合<code>statusOpetors</code>。</li></ul></li> <li><p>获取行数据用户操作</p> <ul><li>根据服务端返回的行数据的用户角色ID(如<code>leaderId</code>, <code>creatorId</code>)和<code>userButtonsMap</code>，确定该行数据用户角色对应的操作按钮集合<code>userOpetors</code>。</li></ul></li> <li><p>求交集</p> <ul><li>将<code>statusOpetors</code>和<code>userOpetors</code>进行交集运算，得到的结果就是当前行数据对当前用户可显示的操作按钮集合。</li></ul></li> <li><p>前端显示</p> <ul><li>根据计算得到的操作按钮集合，动态渲染列表项的操作按钮。</li></ul></li> <li><p>优点</p> <ul><li><p>灵活性：通过维护映射表，可以方便地添加、修改或删除数据状态、用户角色以及操作按钮的映射关系。</p></li> <li><p>安全性：确保只有满足特定条件和角色的用户才能看到和执行相应的操作，增强了系统的安全性。</p></li> <li><p>用户体验：只展示用户真正需要的操作按钮，简化界面，提升用户体验。</p></li></ul></li></ol> <blockquote><p>​	下面是一个示例：</p> <p>​	假设我们有一个企业内部的任务管理系统，每个任务都有一个状态（如待分配、进行中、已完成），并且每个任务都与一个或多个用户相关联（如任务创建者、任务负责人）。不同的用户角色（如普通员工、项目经理、管理员）对任务的操作权限也有所不同。</p> <ul><li><p>数据状态：</p> <ul><li>待分配（<code>pending_assignment</code>）</li> <li>进行中（<code>in_progress</code>）</li> <li>已完成（<code>completed</code>）</li></ul></li> <li><p>用户角色：</p> <ul><li>普通员工（<code>employee</code>）</li> <li>项目经理（<code>project_manager</code>）</li> <li>管理员（<code>admin</code>）</li></ul> <p>对于某个任务，服务端可能返回以下数据：</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token comment">// 当前用户userC登录后查看任务ID为123的任务，该任务的状态为pending_assignment</span>
  <span class="token property">&quot;taskId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;taskStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pending_assignment&quot;</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;creatorId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 任务的创建者</span>
  <span class="token property">&quot;assigneeId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userB&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 被分配的任务负责人</span>
  <span class="token property">&quot;currentUserId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userC&quot;</span> <span class="token comment">//当前登录查看任务的用户</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​	设置statusButtonsMap：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>const statusButtonsMap = <span class="token punctuation">{</span>  
  <span class="token property">&quot;pending_assignment&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;assign&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;in_progress&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;completed&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reopen&quot;</span><span class="token punctuation">]</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	设置userButtonsMap：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>const userButtonsMap = <span class="token punctuation">{</span>  
  <span class="token property">&quot;admin&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;assign&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reopen&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;project_manager&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;assign&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reopen&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
  <span class="token property">&quot;employee&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">]</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	获取行数据状态操作：根据 <code>taskStatus</code>(<code>pending_assignment</code>)和 <code>statusButtonsMap</code>，得到操作按钮集合 <code>statusOpetors</code> 为 <code>[&quot;assign&quot;, &quot;delete&quot;]</code>。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 根据任务状态获取操作按钮集合  </span>
<span class="token keyword">const</span> statusOpetors <span class="token operator">=</span> statusButtonsMap<span class="token punctuation">[</span>taskStatus<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 如果找不到对应的状态，则返回空数组  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	获取行数据用户操作：由于当前用户 <code>userC</code> 不是任务的创建者也不是被分配者，我们假设 <code>userC</code> 的角色是 <code>employee</code>。根据 <code>userButtonsMap</code> 和用户角色 <code>employee</code>，得到操作按钮集合 <code>userOpetors</code> 为 <code>[&quot;comment&quot;, &quot;complete&quot;]</code>。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 根据用户角色获取操作按钮集合  </span>
<span class="token keyword">const</span> userOpetors <span class="token operator">=</span> userButtonsMap<span class="token punctuation">[</span>currentUserRole<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 如果找不到对应的角色，则返回空数组  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	求交集：<code>statusOpetors</code> 和 <code>userOpetors</code> 的交集为空，这意味着 <code>userC</code>(作为普通员工)在当前任务状态下没有任何可操作的按钮。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 计算交集  </span>
<span class="token keyword">const</span> intersection <span class="token operator">=</span> statusOpetors<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">button</span> <span class="token operator">=&gt;</span> userOpetors<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	但如果 <code>userC</code> 是管理员(<code>admin</code>)，那么将得到 <code>[&quot;assign&quot;, &quot;delete&quot;]</code>，因为这是管理员在任务处于待分配状态时允许执行的操作。</p> <p>​	前端展示：根据求得的交集结果，前端将不展示任何操作按钮给 <code>userC</code>（作为普通员工），因为该用户在当前任务状态下没有操作权限。如果 <code>userC</code> 是管理员，则会显示“分配”和“删除”按钮。</p></blockquote> <h2 id="单点登录"><a href="#单点登录" class="header-anchor">#</a> 单点登录</h2> <p>​	单点登录（Single Sign-On，简称SSO）是一种身份验证和授权过程，它允许用户使用一个身份(通常是一个用户名和密码或一个认证令牌)在多个应用程序或服务中进行登录。<strong>一旦用户在一个应用程序或服务中通过了身份验证，他们就可以访问与之集成的其他所有应用程序或服务，而无需再次输入用户名和密码。</strong></p> <p>​	SSO的核心思想是实现用户身份的统一管理和认证，减少用户在不同应用之间频繁登录的麻烦，提高用户体验。同时，它也有助于降低企业IT部门的管理成本，提高系统的安全性。</p> <p><img src="/vivien-blog/assets/img/jwt.64ad675a.png" alt="img"></p> <p><img src="/vivien-blog/assets/img/sso.5ac1c6b5.png" alt="img"></p> <h2 id="权限管理实现步骤-实操"><a href="#权限管理实现步骤-实操" class="header-anchor">#</a> 权限管理实现步骤(实操)</h2> <h3 id="页面-菜单权限-3"><a href="#页面-菜单权限-3" class="header-anchor">#</a> 页面/菜单权限</h3> <ol><li>登录成功后，获取到token和用户信息，进行存储，然后跳转首页</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 登录方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//添加 try catch 捕获异常</span>
    <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">Login</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">GetUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">routerNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>接着，进行路由跳转到首页</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">routerNext</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>value<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果重新登陆后需要返回原先的路由地址</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>value<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect <span class="token keyword">as</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;TV_FDS_LIST&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>在后台权限管理系统根据侧边栏目录配置侧边栏和菜单、前端项目代码配置路由</li></ol> <img src="/vivien-blog/assets/img/image-20240424084516011.d20d07ab.png" alt="image-20240424084516011" style="zoom:80%;"> <ol start="3"><li>后端接口返回用户有权限访问的路由表和拥有的权限列表</li></ol> <img src="/vivien-blog/assets/img/image-20240424094913595-1713923364458-1.b7d1fb64.png" alt="image-20240424094913595" style="zoom:80%;"> <ol start="4"><li>递归匹配后端路由和前端路由配置，添加路由异步路由表和常规路由表，形成最终的路由表</li></ol> <p>​	递归后端接口返回的信息获取用户权限列表的方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**  【工具方法】
 * 获取嵌套对象的所有对象的 key 对应 value值
 * @param {*} data 嵌套对象
 * @param {*} arr 存放属性数组
 * @param {*} children 保存嵌套子对象的属性
 * @param {*} key 获取的 value 对应的 key
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getChildValue</span><span class="token punctuation">(</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">arr</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'children'</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key <span class="token operator">||</span> data<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span>children<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">getChildValue</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">,</span> arr<span class="token punctuation">,</span> key<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 获取用户权限列表</span>
<span class="token keyword">async</span> <span class="token function">GetAuthority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAuthList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token literal-property property">leftMenuNames</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 递归获取后端路由 name 的数组存入 leftMenuNames</span>
    <span class="token function">getChildValue</span><span class="token punctuation">(</span>data<span class="token operator">?.</span>menu <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftMenuNames<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'children'</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>menuNames <span class="token operator">=</span> leftMenuNames <span class="token comment">//设置用户的菜单权限名称列表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetAuthority</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ClearLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>​	前端匹配生成路由的方法(调用时使用<code>routeStore.GenerateRoutes(accessRoutes?.menuNames || [])</code>)：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 生成异步路由</span>
<span class="token function">GenerateRoutes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routesMenuNames</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteItem<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 过滤常量路由：过滤没有权限的常量路由</span>
  <span class="token function">filterRoutes</span><span class="token punctuation">(</span>basicRoutes<span class="token punctuation">,</span> routesMenuNames<span class="token punctuation">)</span>
  <span class="token comment">// 过滤异步路由：过滤没有权限的异步路由</span>
  <span class="token function">filterRoutes</span><span class="token punctuation">(</span>asyncRoutes<span class="token punctuation">,</span> routesMenuNames<span class="token punctuation">)</span>
  <span class="token comment">// 整合路由表</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetRoutes</span><span class="token punctuation">(</span>asyncRoutes<span class="token punctuation">,</span> basicRoutes<span class="token punctuation">)</span>
  <span class="token keyword">return</span> asyncRoutes
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​	过滤路由的方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 过滤没有权限的路由：递归前端路由，查找 name 不存在的路由，删除
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">filterRoutes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routesInstans</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">routesMenuNames</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开发环境侧边栏路由不由后台管理系统控制</span>
  <span class="token comment">// if (process.env.NODE_ENV === envEnum.DEVELOPMENT) return</span>
  <span class="token comment">// 测试和生产环境下，对常量路由进行过滤</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> routesInstans<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> routesInstans<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">filterRoutes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">,</span> routesMenuNames<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>routesMenuNames <span class="token operator">&amp;&amp;</span> routesMenuNames<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>route<span class="token operator">?.</span>hidden<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      route<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token punctuation">(</span>routesMenuNames<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>​	整合路由表的方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 整合路由表</span>
<span class="token function">SetRoutes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">asyncFilterRoutes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">constantAsyncRoutes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>routes <span class="token operator">=</span> constantAsyncRoutes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>asyncFilterRoutes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value1</span><span class="token operator">:</span> RouteItem<span class="token punctuation">,</span> <span class="token literal-property property">value2</span><span class="token operator">:</span> RouteItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value1<span class="token operator">?.</span>order <span class="token operator">-</span> value2<span class="token operator">?.</span>order<span class="token punctuation">)</span> <span class="token comment">//【权限路由】所有路由</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>addRoutes <span class="token operator">=</span> asyncFilterRoutes <span class="token comment">//【异步路由】新增异步路由</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>根据生成的路由表设置侧边栏菜单</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 设置侧边栏路由</span>
<span class="token function">SetRoute</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteItem<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>routes <span class="token operator">=</span> routes
<span class="token punctuation">}</span><span class="token punctuation">,</span>
    
<span class="token comment">/**
 * 设置二级菜单显示的路由
 * @param {} param0
 * @param {*} routes 当前路由对象，包含路由名称 name 或则路由路径
 * @returns
 */</span>
<span class="token function">SetShowRouters</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> RouteItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> matched <span class="token punctuation">}</span> <span class="token operator">=</span> routes
  <span class="token keyword">let</span> topRouteName <span class="token operator">=</span> name <span class="token comment">// 二级路由顶部菜单栏名称</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>matched <span class="token operator">&amp;&amp;</span> matched<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 根据路由匹配路径获取二级顶部菜单栏名称</span>
    topRouteName <span class="token operator">=</span> matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> filterRouter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>name <span class="token operator">!==</span> topRouteName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> item
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetRoute</span><span class="token punctuation">(</span>filterRouter<span class="token punctuation">)</span>
  <span class="token keyword">return</span> routes
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="6"><li>当进行路由跳转时，路由守卫先判断token，没有token且路由地址也不在路由白名单内，就让用户跳转到登录页重新登陆拿token；如果有token，就需要对用户权限进行校验。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> type <span class="token punctuation">{</span> Router<span class="token punctuation">,</span> RouteRecordRaw<span class="token punctuation">,</span> RouteItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken<span class="token punctuation">,</span> getOAToken<span class="token punctuation">,</span> getOALoginToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/utils/token&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">WHITE_NAME_LIST</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PageEnum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/enums/pageEnum'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStoreWithOut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/modules/common/user&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> routesStoreWithOut <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/modules/common/routes&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;element-plus&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">useUserStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> routeStore <span class="token operator">=</span> <span class="token function">routesStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPermissionGuard</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">router</span><span class="token operator">:</span> Router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 问题： 直接使用 router.beforeEach 会导致在刷新页面时无法进入 router.beforeEach 的回调函数
     * 原因：可能是因为在刷新页面时，Vue Router 的初始化过程尚未完成，导致路由守卫无法正常触发。
     * 解决方案：将 router.beforeEach 回调函数的逻辑放在一个异步函数中，并在 Vue Router 初始化完成后再调用这个异步函数。你可以使用 router.isReady() 方法来判断 Vue Router 是否已经初始化完成。
     * isReady: isReady(): Promise&lt;void&gt; 返回一个 Promise，它会在路由器完成初始导航之后被解析，也就是说这时所有和初始路由有关联的异步入口钩子和异步组件都已经被解析。如果初始导航已经发生，则该 Promise 会被立刻解析。
     */</span>
    router<span class="token punctuation">.</span><span class="token function">isReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">routerPermission</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取 oa 中的 token</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span> oaToken <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getOAToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>oaToken<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// oa 存在 token，用户已经登录 oa</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 使用 oa token 登录系统</span>
                        <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">CheckOaLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 获取新 oa token:LtpaToken, 通过创建 iframe,重定向获取 oa 登录 token</span>
                        <span class="token keyword">await</span> <span class="token function">getOALoginToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        userStore<span class="token punctuation">.</span><span class="token function">ClearLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;/login?redirect=&quot;</span> <span class="token operator">+</span> to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITE_NAME_LIST</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>name <span class="token keyword">as</span> string<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// 用户未登录</span>
                    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;/login?redirect=&quot;</span> <span class="token operator">+</span> to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>


<span class="token comment">/**
 * 路由权限判断函数,根据路由权限进入不同路由
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">routerPermission</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">to</span><span class="token operator">:</span> RouteItem<span class="token punctuation">,</span> <span class="token literal-property property">from</span><span class="token operator">:</span> RouteItem<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 已经存在 token, 进入用户登录页面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">==</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_LOGIN</span> <span class="token operator">&amp;&amp;</span> from<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 从登录页面进入，直接进入登录页面</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>from<span class="token punctuation">.</span>path <span class="token operator">===</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_LOGIN</span> <span class="token operator">||</span> PageEnum<span class="token punctuation">.</span><span class="token constant">ROOT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//已经存在 token, 从其他页面进入用户登录页面，直接返回来源页面</span>
            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> canAccess <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">canUserAccess</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>canAccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;您没有权限访问页面,请联系系统管理员!&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
* 获取异步权限
* @param to 
* @returns 
*/</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">canUserAccess</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">to</span><span class="token operator">:</span> RouteItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>to <span class="token operator">||</span> to<span class="token operator">?.</span>name <span class="token operator">===</span> <span class="token string">&quot;Login&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> accessRoutes <span class="token operator">=</span> userStore<span class="token punctuation">.</span>getAuthority <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">//获取用户权限列表</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>accessRoutes<span class="token operator">?.</span>menuNames <span class="token operator">&amp;&amp;</span> accessRoutes<span class="token operator">?.</span>menuNames<span class="token operator">?.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//菜单权限名称列表</span>
            accessRoutes <span class="token operator">=</span> <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">GetAuthority</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            routeStore<span class="token punctuation">.</span><span class="token function">GenerateRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token operator">?.</span>menuNames <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> allRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">WHITE_NAME_LIST</span><span class="token punctuation">,</span> <span class="token operator">...</span>accessRoutes<span class="token operator">?.</span>menuNames<span class="token punctuation">]</span>
        <span class="token keyword">return</span> allRoutes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> allRoutes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userStore<span class="token punctuation">.</span><span class="token function">Logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><h3 id="组件-按钮级权限-vue2"><a href="#组件-按钮级权限-vue2" class="header-anchor">#</a> 组件/按钮级权限（Vue2）</h3> <blockquote><p>​	主流的按钮级权限的设计方案有两种：</p> <ul><li><strong>条件渲染：</strong> 在前端代码中根据用户的权限信息来决定是否渲染特定的按钮或组件。比如，可以使用条件语句如(<code>v-if</code>、<code>ng-if</code>)等来判断用户是否有权限，从而决定是否渲染按钮。</li> <li><strong>指令/组件封装：</strong> 使用一些前端框架(如Vue、React)提供的自定义指令或组件，可以封装权限控制逻辑。可以创建一个自定义指令或组件，接受用户权限作为输入，然后根据权限来决定是否显示按钮。</li></ul></blockquote> <ol><li>获取服务端返回的用户权限集合</li></ol> <p><img src="/vivien-blog/assets/img/image-20240424101910191.67393cb3.png" alt="image-20240424101910191"></p> <ol start="2"><li>获取本地权限标识配置列表</li></ol> <p><img src="/vivien-blog/assets/img/image-20240424102015998.4eb682f4.png" alt="image-20240424102015998"></p> <p><img src="/vivien-blog/assets/img/image-20240424104435010.fa57b08d.png" alt="image-20240424104435010"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/** @/permission/index.js
 * 权限配置模块文件，统一引入所有权限配置文件
 */</span>

<span class="token comment">//  require.context返回modules文件夹下所有的文件对象,参考https://webpack.js.org/guides/dependency-management/#requirecontext</span>
<span class="token keyword">const</span> modulesFiles <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./modules'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token comment">/*
*通过直接获取modules文件夹下的所有文件添加进入modules对象
*回调函数参数：
*modules：文件对象
*modulePath：文件路径
*/</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> modulesFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">modules<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取文件名称</span>
  <span class="token keyword">const</span> moduleName <span class="token operator">=</span> modulePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/(.*)\.\w+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'$1'</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取路径保存在modulePath文件内容</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">modulesFiles</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>

  <span class="token comment">// 修改modules对象</span>
  modules<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">.</span>default

  <span class="token keyword">return</span> modules
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> modules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="3"><li>根据传入参数，获取判断的权限标识</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/** @/directive/permission.js
 * 权限指令
 * 使用： v-permission=&quot;{module:'模块名称',auth:'权限key值'}&quot;
 */</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> permissionList <span class="token keyword">from</span> <span class="token string">'@/permission'</span>

<span class="token comment">/**
 * 全局权限判断方法
 * @param {*} permission 权限对象，格式 {module:'模块名称',auth:'权限key值'}
 * @param {*} callback 权限回调函数，有权限则执行回调
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hasPermissions</span><span class="token punctuation">(</span><span class="token parameter">permission<span class="token punctuation">,</span> callback <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> permissions <span class="token operator">=</span> store<span class="token punctuation">.</span>getters <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>permissions
  <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span>module <span class="token operator">&amp;&amp;</span> permission<span class="token punctuation">.</span>auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> permissionList<span class="token punctuation">[</span>permission<span class="token punctuation">.</span>module<span class="token punctuation">]</span><span class="token punctuation">[</span>permission<span class="token punctuation">.</span>auth<span class="token punctuation">]</span>
    <span class="token keyword">const</span> haspermiss <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    haspermiss <span class="token operator">&amp;&amp;</span> callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> haspermiss
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasPermissions</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">inserted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">checkPermission</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">checkPermission</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ol start="4"><li>注册自定义指令</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> permission <span class="token keyword">from</span> <span class="token string">'./permission'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hasPermissions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./permission'</span>

<span class="token keyword">const</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$hasPermissions <span class="token operator">=</span> hasPermissions
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">,</span> permission<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">[</span><span class="token string">'permission'</span><span class="token punctuation">]</span> <span class="token operator">=</span> permission
  Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>install<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>
<span class="token punctuation">}</span>

permission<span class="token punctuation">.</span>install <span class="token operator">=</span> install
<span class="token keyword">export</span> <span class="token keyword">default</span> permission
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="5"><li>使用</li></ol> <ul><li>v-permission方式</li></ul> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
    <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{module:moduleName,auth:'dqaAuthCcInsert'}<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showDialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>审核<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>this.$hasPermissions方式</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 项目访问权限</span>
<span class="token function">hasProjectViewsPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$hasPermissions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'material'</span><span class="token punctuation">,</span> <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token constant">OPE_ENUM</span><span class="token punctuation">.</span><span class="token constant">VIEW</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>v-if方式</li></ul> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 方式一 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$hasPermissions({ module: 'odf', auth: 'getConfirm' })<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit(scrop.row)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    提交
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 方式二 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.$hasPermissions({ module: 'specialize', auth: 'addProject'})<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showAdd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    新增项目
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="组件-按钮级权限-vue3"><a href="#组件-按钮级权限-vue3" class="header-anchor">#</a> 组件/按钮级权限（Vue3）</h3> <blockquote><p>Github：https://github.com/yoguoer/v-permission.git</p> <p>CSDN：http://t.csdnimg.cn/aNPOZ</p></blockquote> <ol><li>在根目录下新建一个directive文件夹，用来存放我们自己开发的所有插件。为了便于区分，我们再建一个vPermission文件夹，用来存放我们的v-permission插件。</li></ol> <p>​    2. 封装权限判断方法。在directive/vPermission/<strong>permission.ts</strong>文件写入以下内容：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
* 权限指令
* 使用： v-permission=&quot;{module:'模块名称',auth:'权限key值'}&quot;
* const hasPermi = hasPermissions({ module: 'someModule', auth: 'someAuth' });
*/</span>

<span class="token comment">/**  
  * 初始化全局权限判断方法  
  * permissionList 系统预先配置的权限列表，包含所有权限信息
  * permissions 用户当前权限列表(服务端返回接口权限列表数据) 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initHasPermission</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
  <span class="token keyword">const</span> <span class="token punctuation">{</span> permissionList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> permissions <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>    
  <span class="token comment">// 返回一个函数，该函数接收一个权限对象并返回是否有权限    </span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">permission</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>permissionList <span class="token operator">||</span> <span class="token operator">!</span>permissions<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'permissionList or permissions is null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span>module <span class="token operator">&amp;&amp;</span> permission<span class="token punctuation">.</span>auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      <span class="token keyword">const</span> value <span class="token operator">=</span> permissionList<span class="token punctuation">[</span>permission<span class="token punctuation">.</span>module<span class="token punctuation">]</span><span class="token punctuation">[</span>permission<span class="token punctuation">.</span>auth<span class="token punctuation">]</span><span class="token punctuation">;</span>    
      <span class="token keyword">return</span> permissions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment">// 检查权限并执行相应的操作  </span>
<span class="token keyword">function</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> hasPermissions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> binding<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>module <span class="token operator">&amp;&amp;</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">.</span>auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasPermissions</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 如果有权限，确保元素可见  </span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token comment">// 权限指令  </span>
<span class="token comment">// 创建一个返回指令对象的函数，该函数接受 hasPermissions 函数作为参数  </span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createPermissionDirective</span><span class="token punctuation">(</span><span class="token parameter">hasPermissions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>  
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">checkPermission</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> hasPermissions<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span><span class="token punctuation">,</span>  
    <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">checkPermission</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> hasPermissions<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>​    3. 注册自定义指令。在directive/vPermission/<strong>index.ts</strong>文件写入以下内容：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> createPermissionDirective <span class="token keyword">from</span> <span class="token string">'./permission'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initHasPermission <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./permission'</span>

<span class="token comment">// Vue 3 插件定义   </span>
<span class="token keyword">const</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>app<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/** permissionList 系统预先配置的权限列表，包含所有权限信息
  *   permissions 用户当前权限列表(服务端返回接口权限列表数据) 
  */</span>
  <span class="token literal-property property">permissionList</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">permissions</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 初始化权限检查函数 </span>
  <span class="token keyword">const</span> hasPermissions <span class="token operator">=</span> <span class="token function">initHasPermission</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 添加全局方法 $hasPermissions  </span>
  app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$hasPermissions <span class="token operator">=</span> hasPermissions<span class="token punctuation">;</span>


  <span class="token comment">// 提供全局的权限检查对象 </span>
  app<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'hasPermissions'</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$hasPermissions<span class="token punctuation">)</span><span class="token punctuation">;</span> 

  <span class="token comment">// 使用 hasPermissions 函数创建指令对象  </span>
  <span class="token keyword">const</span> permissionDirective <span class="token operator">=</span> <span class="token function">createPermissionDirective</span><span class="token punctuation">(</span>hasPermissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册全局指令 v-permission  </span>
  app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">,</span> permissionDirective<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">// 导出插件对象  </span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="4"><li>使用</li></ol> <ul><li>在你的项目根目录中新建一个permission文件夹，并在文件夹下新建一个index.ts文件和一个modules文件夹。</li></ul> <blockquote><p>modules文件夹用来放置不同模块的权限控制文件（一般各个模块各自建一个.ts文件），而index.ts用来遍历读取modules下的所有文件，并将所有文件转换为键值对的形式，整合成一个包含系统所有权限信息的对象，即：{ 模块名：{ 该模块的权限列表 }, ... }。</p></blockquote> <ul><li>在permission/index.ts文件中键入以下代码：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/** 
 * 权限配置模块文件，统一引入所有权限配置文件
 */</span>
<span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'./modules/*.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> path <span class="token keyword">in</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  files<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fileNameMatch <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^\/\\]+?)\.\w+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fileName <span class="token operator">=</span> fileNameMatch <span class="token operator">?</span> fileNameMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    modules<span class="token punctuation">[</span>fileName <span class="token keyword">as</span> string<span class="token punctuation">]</span> <span class="token operator">=</span> mod<span class="token operator">?.</span>default
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> modules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>在modules下新建所需要的模块文件，文件中的内容格式形如以下例子（权限key值: 权限标识）：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">add</span><span class="token operator">:</span> <span class="token string">'/add-add'</span><span class="token punctuation">,</span>
    <span class="token keyword">delete</span><span class="token operator">:</span> <span class="token string">'/delete-delete'</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">edit</span><span class="token operator">:</span> <span class="token string">'/edit-edit'</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>引入index.ts中整理好的系统预先配置的权限列表，作为我们所需要的参数permissionList，。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> permissionList <span class="token keyword">from</span> <span class="token string">'./permission'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>通过接口获取当前用户的权限列表，作为我们所需要的参数permissions。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> permissions <span class="token keyword">from</span> <span class="token string">'存放服务端返回接口权限列表数据的地方'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>permissionList形如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;admin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;add&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/admin-add&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/admin-delete&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;edit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/admin-edit&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;add&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/user-add&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/user-delete&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>permissions形如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
    <span class="token string">&quot;/user-add&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;/user-delete&quot;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <ul><li>在项目中的入口文件中引入 v-permission，将前面提到的两个参数作为选项，然后使用插件并传入选项：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./views/App.vue'</span>
<span class="token keyword">import</span> permission <span class="token keyword">from</span> <span class="token string">&quot;v-permission&quot;</span> 
<span class="token keyword">import</span> permissionList <span class="token keyword">from</span> <span class="token string">'./permission'</span>
<span class="token keyword">import</span> permissions <span class="token keyword">from</span> <span class="token string">'存放服务端返回接口权限列表数据的地方'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    permissionList<span class="token punctuation">,</span>
    permissions
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>permission<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><p>以指令的方式使用：</p> <ul><li><p>v-permission指令形式：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>button v<span class="token operator">-</span>permission<span class="token operator">=</span><span class="token string">&quot;{ module: '模块名', auth: '权限key值' }&quot;</span><span class="token operator">&gt;</span> 有权限则显示 <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>v-if指令形式：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>button v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;hasPermissions({ module: '模块名', auth: '权限key值' })&quot;</span><span class="token operator">&gt;</span> 有权限则显示 <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>以方法的方式使用：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 注入权限判断方法 hasPermissions</span>
  <span class="token keyword">const</span> hasPermissions <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&quot;hasPermissions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPermissions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'模块名'</span><span class="token punctuation">,</span> <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token string">'权限key值'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用户有权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用户没有权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h3 id="与用户信息挂钩-数据权限-3"><a href="#与用户信息挂钩-数据权限-3" class="header-anchor">#</a> 与用户信息挂钩/数据权限</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> commonStatusButsMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   *  状态对应显示按钮map
   * */</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receive&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 未领取：查看、领取（未领取状态下没有责任人，为默认创建的任务）</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receive&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;editAll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 未开始：查看、领取、修改、删除</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 进行中：查看、编辑、删除</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 已完成：查看、审核、删除</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 结束：查看、删除</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * =================权限列表=================
 * 创建人 create_id： 查看、领取、修改、编辑、点检、删除
 * 责任人 duty_id： 查看、 领取、编辑、点检、删除
 * 确认人 leader_id： 查看、 审核、点检、删除、编辑
 */</span>
<span class="token keyword">const</span> permissionMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">creator</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receive&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;editAll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pointInspection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duty</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receive&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pointInspection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;editAll&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">leader</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pointInspection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;editAll&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 过滤获取权限按钮(未领取状态下，无责任人，开放对应状态下所有按钮)</span>
<span class="token keyword">const</span> permissionBut <span class="token operator">=</span>
    <span class="token function">Number</span><span class="token punctuation">(</span>rowData<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token operator">?</span> commonButs
    <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filterPermission</span><span class="token punctuation">(</span>commonButs<span class="token punctuation">,</span> rowData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//过滤获取按钮显示权限(用户信息相关)</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filterProgress</span><span class="token punctuation">(</span>permissionBut<span class="token punctuation">,</span> rowData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//过滤获取流程控制按钮(数据状态相关)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2024/7/13 09:35:35</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vivien-blog/project/权限控制/系统权限控制插件.html">
          系统权限控制插件
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-9f22dc18 data-v-222e0b9d><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#rbac模型" class="sidebar-link reco-side-rbac模型" data-v-9f22dc18>RBAC模型</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#rbac支持的安全原则" class="sidebar-link reco-side-rbac支持的安全原则" data-v-9f22dc18>RBAC支持的安全原则</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#rbac的基本数据元素" class="sidebar-link reco-side-rbac的基本数据元素" data-v-9f22dc18>RBAC的基本数据元素</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#rbac设计思想" class="sidebar-link reco-side-rbac设计思想" data-v-9f22dc18>RBAC设计思想</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#rbac-权限管理的在实际系统中的应用" class="sidebar-link reco-side-rbac-权限管理的在实际系统中的应用" data-v-9f22dc18>RBAC 权限管理的在实际系统中的应用</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#vben的三种权限处理方式" class="sidebar-link reco-side-vben的三种权限处理方式" data-v-9f22dc18>Vben的三种权限处理方式：</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#前端角色权限" class="sidebar-link reco-side-前端角色权限" data-v-9f22dc18>前端角色权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#后台动态获取" class="sidebar-link reco-side-后台动态获取" data-v-9f22dc18>后台动态获取</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#vue-router" class="sidebar-link reco-side-vue-router" data-v-9f22dc18>vue-router</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#router-addroute" class="sidebar-link reco-side-router-addroute" data-v-9f22dc18>router.addRoute()</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#router-beforeeach" class="sidebar-link reco-side-router-beforeeach" data-v-9f22dc18>router.beforeEach</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#router-aftereach" class="sidebar-link reco-side-router-aftereach" data-v-9f22dc18>router.afterEach</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#beforeresolve" class="sidebar-link reco-side-beforeresolve" data-v-9f22dc18>beforeResolve</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#beforeenter" class="sidebar-link reco-side-beforeenter" data-v-9f22dc18>beforeEnter</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#beforerouteenter" class="sidebar-link reco-side-beforerouteenter" data-v-9f22dc18>beforeRouteEnter</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#beforerouteleave" class="sidebar-link reco-side-beforerouteleave" data-v-9f22dc18>beforeRouteLeave</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#权限管理" class="sidebar-link reco-side-权限管理" data-v-9f22dc18>权限管理</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#页面-菜单权限" class="sidebar-link reco-side-页面-菜单权限" data-v-9f22dc18>页面/菜单权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#组件-按钮级权限" class="sidebar-link reco-side-组件-按钮级权限" data-v-9f22dc18>组件/按钮级权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#与用户信息挂钩-数据权限" class="sidebar-link reco-side-与用户信息挂钩-数据权限" data-v-9f22dc18>与用户信息挂钩/数据权限</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#权限管理实现思路" class="sidebar-link reco-side-权限管理实现思路" data-v-9f22dc18>权限管理实现思路</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#页面-菜单权限-2" class="sidebar-link reco-side-页面-菜单权限-2" data-v-9f22dc18>页面/菜单权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#组件-按钮级权限-2" class="sidebar-link reco-side-组件-按钮级权限-2" data-v-9f22dc18>组件/按钮级权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#与用户信息挂钩-数据权限-2" class="sidebar-link reco-side-与用户信息挂钩-数据权限-2" data-v-9f22dc18>与用户信息挂钩/数据权限</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#单点登录" class="sidebar-link reco-side-单点登录" data-v-9f22dc18>单点登录</a></li><li class="level-2" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#权限管理实现步骤-实操" class="sidebar-link reco-side-权限管理实现步骤-实操" data-v-9f22dc18>权限管理实现步骤(实操)</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#页面-菜单权限-3" class="sidebar-link reco-side-页面-菜单权限-3" data-v-9f22dc18>页面/菜单权限</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#组件-按钮级权限-vue2" class="sidebar-link reco-side-组件-按钮级权限-vue2" data-v-9f22dc18>组件/按钮级权限（Vue2）</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#组件-按钮级权限-vue3" class="sidebar-link reco-side-组件-按钮级权限-vue3" data-v-9f22dc18>组件/按钮级权限（Vue3）</a></li><li class="level-3" data-v-9f22dc18><a href="/vivien-blog/project/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html#与用户信息挂钩-数据权限-3" class="sidebar-link reco-side-与用户信息挂钩-数据权限-3" data-v-9f22dc18>与用户信息挂钩/数据权限</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/vivien-blog/assets/js/app.49640b82.js" defer></script><script src="/vivien-blog/assets/js/7.ec60f3e8.js" defer></script><script src="/vivien-blog/assets/js/2.6744b811.js" defer></script><script src="/vivien-blog/assets/js/1.4a3363c7.js" defer></script><script src="/vivien-blog/assets/js/29.050194a5.js" defer></script>
  </body>
</html>
